matrix:
  include:
    - language: objective-c
      os: osx
      osx_image: xcode8.3
      xcode_project: ./publicreactnativeapp.xcodeproj # path to your xcodeproj folder
      xcode_scheme: publicreactnativeapp
      node_js: false
      sudo: required
      env:
        - LC_ALL=en_US.UTF-8
        - LANG=en_US.UTF-8
        - NODE_OPTIONS="--max-old-space-size=4096"
      before_install:
        - pwd
        - gem install bundler
        - gem install fastlane
      install:
        - pwd
        - npm install
      script:
        - pwd
        - cd ./ios && bundle install
        - bundle update
        - bundle exec fastlane ios travisenable
        - bundle exec fastlane ios travismatch
        - for i in $(seq 1 60); do sleep 20; echo $i; done
        - bundle exec fastlane ios travisgym
  exclude:
    - language: android
      jdk: oraclejdk8
      sudo: required
      dist: precise
      env:
        - LC_ALL=en_US.UTF-8
        - LANG=en_US.UTF-8
      before_cache:
        - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      cache:
        yarn: true
        directories:
          - $HOME/.gradle/caches/
          - $HOME/.gradle/wrapper/
          - node_modules
      android:
        components:
          - platform-tools
          - tools
          - build-tools-28.0.3
          - android-27
          - extra-android-m2repository
          - extra-google-google_play_services
          - extra-google-m2repository
          - sys-img-armeabi-v7a-android-28
      licenses:
        - android-sdk-preview-license-.+
        - android-sdk-license-.+
        - google-gdk-license-.+
      before_install:
        - nvm install 11.6
        - node --version
        - PATH="/bin:$PATH" rvm use 2.6.0 --install --binary --fuzzy
        - ruby --version
        - chmod +x ./android/gradlew
        - pwd
        - gem update --system
        - gem install bundler
        - pwd
        - openssl aes-256-cbc -K $encrypted_d51915f205d6_key -iv $encrypted_d51915f205d6_iv -in ./android/app/my-release-key.keystore.enc -out ./android/app/my-release-key.keystore -d
        - openssl aes-256-cbc -K $encrypted_d51915f205d6_key -iv $encrypted_d51915f205d6_iv -in ./android/app/my-release-key.keystore.enc -out ./android/my-release-key.keystore -d
        - cd android && bundle install && bundle update && ./gradlew clean
      install:
        - npm install
      script:
        - pwd
        - ls
        - ls ./app
        - fastlane supply init
        - bundle exec fastlane test
        - bundle exec fastlane build
      after_script:
        - chmod +x ./android/gradlew
        - ./gradlew assembleRelease
      branches:
        only:
        - master