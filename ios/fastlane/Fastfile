# Opt out of Analytics
opt_out_usage

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane(
#   nightly: true
#   )

default_platform(:ios)

platform :ios do

  lane :localmatch do
    sync_code_signing(
      type: "appstore",
      git_url:"https://github.com/ncmd/public-fastlane-certificates",
      keychain_name:"login.keychain",
      keychain_password:"Changeme@1"
      )
  end

  lane :localgym do

    gym(
      scheme: "publicreactnativeapp",
      clean: true,
      silent: true,
      project: "./publicreactnativeapp.xcodeproj",
      include_bitcode: false,
      codesigning_identity:"iPhone Distribution: Charles Chong (9S2JY9AX68)",
      export_method: "app-store",
      export_options: {
        uploadBitcode: false,
        uploadSymbols: true,
        compileBitcode: false,
        provisioningProfiles: { 
          "com.ncmd.publicreactnativeapp" => "match AppStore com.ncmd.publicreactnativeapp"
        }
      }
    )
  end

  lane :localupload do
    upload_to_app_store(skip_metadata: true, skip_screenshots: true)
  end

  desc "travis enable"
  lane :travisenable do |values|
    setup_travis
  end

  lane :travismatch do |values|
    
    setup_travis

    sync_code_signing(
      type: "appstore",
      git_url:"https://github.com/ncmd/public-fastlane-certificates",
      keychain_name:"fastlane_tmp_keychain"
      )
  end

  lane :travisgym do |values|

    # sync_code_signing(
    #   type: "appstore",
    #   git_url:"https://github.com/ncmd/public-fastlane-certificates",
    #   keychain_name:"fastlane_tmp_keychain"
    #   )

    build_app(
      scheme: "publicreactnativeapp",
      workspace: "publicreactnativeapp.xcworkspace",
      include_bitcode: false,
      export_method: "app-store",
      export_options: {
        uploadBitcode: false,
        uploadSymbols: true,
        compileBitcode: false,
        provisioningProfiles: { 
          "com.ncmd.publicreactnativeapp" => "match AppStore com.ncmd.publicreactnativeapp"
        }
      }
    )
  end

  lane :travisupload do |values|
    increment_build_number(
     xcodeproj: "./publicreactnativeapp.xcodeproj"
    )

    # Upload to App Store
    upload_to_app_store(skip_metadata: true, skip_screenshots: true)
  end
end