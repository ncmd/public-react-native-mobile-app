<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Fastlane::Actions::ResetGitRepoAction - fastlane-2.116.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Action.html">Fastlane::Action</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-author">::author</a>
    
    <li ><a href="#method-c-available_options">::available_options</a>
    
    <li ><a href="#method-c-category">::category</a>
    
    <li ><a href="#method-c-description">::description</a>
    
    <li ><a href="#method-c-details">::details</a>
    
    <li ><a href="#method-c-example_code">::example_code</a>
    
    <li ><a href="#method-c-is_supported-3F">::is_supported?</a>
    
    <li ><a href="#method-c-run">::run</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Fastlane::Actions::ResetGitRepoAction">
  <h1 id="class-Fastlane::Actions::ResetGitRepoAction" class="class">
    class Fastlane::Actions::ResetGitRepoAction
  </h1>

  <section class="description">
    
<p>Does a hard reset and clean on the repo</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-author" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">author</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="author-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/reset_git_repo.rb, line 112</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">author</span>
  <span class="ruby-string">&#39;lmirosevic&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-available_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">available_options</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="available_options-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/reset_git_repo.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">available_options</span>
  [
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:files</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_RESET_GIT_FILES&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Array of files the changes should be discarded. If not given, all files will be discarded&quot;</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                 <span class="ruby-identifier">verify_block</span><span class="ruby-operator">:</span> <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
                                   <span class="ruby-constant">UI</span>.<span class="ruby-identifier">user_error!</span>(<span class="ruby-string">&quot;Please pass an array only&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>)
                                 <span class="ruby-keyword">end</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:force</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_RESET_GIT_FORCE&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Skip verifying of previously clean state of repo. Only recommended in combination with `files` option&quot;</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:skip_clean</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_RESET_GIT_SKIP_CLEAN&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Skip &#39;git clean&#39; to avoid removing untracked files like `.env`&quot;</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:disregard_gitignore</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_RESET_GIT_DISREGARD_GITIGNORE&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Setting this to true will clean the whole repository, ignoring anything in your local .gitignore. Set this to true if you want the equivalent of a fresh clone, and for all untracked and ignore files to also be removed&quot;</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:exclude</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_RESET_GIT_EXCLUDE&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;You can pass a string, or array of, file pattern(s) here which you want to have survive the cleaning process, and remain on disk, e.g. to leave the `artifacts` directory you would specify `exclude: &#39;artifacts&#39;`. Make sure this pattern is also in your gitignore! See the gitignore documentation for info on patterns&quot;</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-category" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">category</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="category-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/reset_git_repo.rb, line 74</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">category</span>
  <span class="ruby-value">:source_control</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-description" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">description</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="description-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/reset_git_repo.rb, line 43</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span>
  <span class="ruby-string">&quot;Resets git repo to a clean state by discarding uncommitted changes&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-details" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">details</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="details-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/reset_git_repo.rb, line 47</span>
      <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">details</span>
        <span class="ruby-identifier">list</span> = <span class="ruby-string">&quot;          You have called the `ensure_git_status_clean` action prior to calling this action. This ensures that your repo started off in a clean state, so the only things that will get destroyed by this action are files that are created as a byproduct of the fastlane run.
&quot;</span>.<span class="ruby-identifier">markdown_list</span>

        [
          <span class="ruby-string">&quot;This action will reset your git repo to a clean state, discarding any uncommitted and untracked changes. Useful in case you need to revert the repo back to a clean state, e.g. after running _fastlane_.&quot;</span>,
          <span class="ruby-string">&quot;Untracked files like `.env` will also be deleted, unless `:skip_clean` is true.&quot;</span>,
          <span class="ruby-string">&quot;It&#39;s a pretty drastic action so it comes with a sort of safety latch. It will only proceed with the reset if this condition is met:&quot;</span>.<span class="ruby-identifier">markdown_preserve_newlines</span>,
          <span class="ruby-identifier">list</span>
        ].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
      <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-example_code" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">example_code</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="example_code-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/reset_git_repo.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">example_code</span>
  [
    <span class="ruby-string">&#39;reset_git_repo&#39;</span>,
    <span class="ruby-string">&#39;reset_git_repo(force: true) # If you don\t care about warnings and are absolutely sure that you want to discard all changes. This will reset the repo even if you have valuable uncommitted changes, so use with care!&#39;</span>,
    <span class="ruby-string">&#39;reset_git_repo(skip_clean: true) # If you want &quot;git clean&quot; to be skipped, thus NOT deleting untracked files like &quot;.env&quot;. Optional, defaults to false.&#39;</span>,
    <span class="ruby-string">&#39;reset_git_repo(
      force: true,
      files: [
        &quot;./file.txt&quot;
      ]
    )&#39;</span>
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-is_supported-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_supported?</span><span
            class="method-args">(platform)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="is_supported-3F-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/reset_git_repo.rb, line 116</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_supported?</span>(<span class="ruby-identifier">platform</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-run" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run</span><span
            class="method-args">(params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="run-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/reset_git_repo.rb, line 7</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:force</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">lane_context</span>[<span class="ruby-constant">SharedValues</span><span class="ruby-operator">::</span><span class="ruby-constant">GIT_REPO_WAS_CLEAN_ON_START</span>]
    <span class="ruby-identifier">paths</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value">:files</span>]

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">paths</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Helper</span>.<span class="ruby-identifier">test?</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">sh</span>(<span class="ruby-string">&#39;git reset --hard HEAD&#39;</span>)

      <span class="ruby-identifier">clean_options</span> = [<span class="ruby-string">&#39;q&#39;</span>, <span class="ruby-string">&#39;f&#39;</span>, <span class="ruby-string">&#39;d&#39;</span>]
      <span class="ruby-identifier">clean_options</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;x&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:disregard_gitignore</span>]
      <span class="ruby-identifier">clean_command</span> = <span class="ruby-string">&#39;git clean&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; -&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">clean_options</span>.<span class="ruby-identifier">join</span>

      <span class="ruby-comment"># we want to make sure that we have an array of patterns, and no nil values</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:exclude</span>].<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Enumerable</span>)
        <span class="ruby-identifier">params</span>[<span class="ruby-value">:exclude</span>] = [<span class="ruby-identifier">params</span>[<span class="ruby-value">:exclude</span>]].<span class="ruby-identifier">compact</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># attach our exclude patterns to the command</span>
      <span class="ruby-identifier">clean_command</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:exclude</span>].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">exclude</span><span class="ruby-operator">|</span> <span class="ruby-string">&#39;-e &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">exclude</span>.<span class="ruby-identifier">shellescape</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:exclude</span>].<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>

      <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">sh</span>(<span class="ruby-identifier">clean_command</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:skip_clean</span>]

      <span class="ruby-constant">UI</span>.<span class="ruby-identifier">success</span>(<span class="ruby-string">&#39;Git repo was reset and cleaned back to a pristine state.&#39;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
        <span class="ruby-constant">UI</span>.<span class="ruby-identifier">important</span>(<span class="ruby-node">&quot;Couldn&#39;t find file at path &#39;#{path}&#39;&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>)
        <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">sh</span>(<span class="ruby-node">&quot;git checkout -- &#39;#{path}&#39;&quot;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-constant">UI</span>.<span class="ruby-identifier">success</span>(<span class="ruby-node">&quot;Git cleaned up #{paths.count} files.&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">user_error!</span>(<span class="ruby-string">&#39;This is a destructive and potentially dangerous action. To protect from data loss, please add the `ensure_git_status_clean` action to the beginning of your lane, or if you\re absolutely sure of what you\re doing then call this action with the :force option.&#39;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

