<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Spaceship::TunesClient - fastlane-2.116.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="Client.html">Spaceship::Client</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-hostname">::hostname</a>
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-video_preview_resolution_for">::video_preview_resolution_for</a>
    
    <li ><a href="#method-i-all_build_trains">#all_build_trains</a>
    
    <li ><a href="#method-i-all_builds_for_train">#all_builds_for_train</a>
    
    <li ><a href="#method-i-app_details">#app_details</a>
    
    <li ><a href="#method-i-app_promocodes">#app_promocodes</a>
    
    <li ><a href="#method-i-app_promocodes_history">#app_promocodes_history</a>
    
    <li ><a href="#method-i-app_version">#app_version</a>
    
    <li ><a href="#method-i-app_version_data">#app_version_data</a>
    
    <li ><a href="#method-i-applications">#applications</a>
    
    <li ><a href="#method-i-availability">#availability</a>
    
    <li ><a href="#method-i-available_languages">#available_languages</a>
    
    <li ><a href="#method-i-build_details">#build_details</a>
    
    <li ><a href="#method-i-build_trains">#build_trains</a>
    
    <li ><a href="#method-i-candidate_builds">#candidate_builds</a>
    
    <li ><a href="#method-i-clear_user_cached_data">#clear_user_cached_data</a>
    
    <li ><a href="#method-i-content_provider_id">#content_provider_id</a>
    
    <li ><a href="#method-i-create_application-21">#create_application!</a>
    
    <li ><a href="#method-i-create_iap-21">#create_iap!</a>
    
    <li ><a href="#method-i-create_iap_family">#create_iap_family</a>
    
    <li ><a href="#method-i-create_member-21">#create_member!</a>
    
    <li ><a href="#method-i-create_sandbox_tester-21">#create_sandbox_tester!</a>
    
    <li ><a href="#method-i-create_version-21">#create_version!</a>
    
    <li ><a href="#method-i-delete_iap-21">#delete_iap!</a>
    
    <li ><a href="#method-i-delete_member-21">#delete_member!</a>
    
    <li ><a href="#method-i-delete_sandbox_testers-21">#delete_sandbox_testers!</a>
    
    <li ><a href="#method-i-fetch_errors_in_data">#fetch_errors_in_data</a>
    
    <li ><a href="#method-i-generate_app_version_promocodes-21">#generate_app_version_promocodes!</a>
    
    <li ><a href="#method-i-get_available_bundle_ids">#get_available_bundle_ids</a>
    
    <li ><a href="#method-i-get_build_info_for_review">#get_build_info_for_review</a>
    
    <li ><a href="#method-i-get_ratings">#get_ratings</a>
    
    <li ><a href="#method-i-get_resolution_center">#get_resolution_center</a>
    
    <li ><a href="#method-i-get_reviews">#get_reviews</a>
    
    <li ><a href="#method-i-group_for_view_by">#group_for_view_by</a>
    
    <li ><a href="#method-i-handle_itc_response">#handle_itc_response</a>
    
    <li ><a href="#method-i-iap_families">#iap_families</a>
    
    <li ><a href="#method-i-iap_subscription_pricing_target">#iap_subscription_pricing_target</a>
    
    <li ><a href="#method-i-iaps">#iaps</a>
    
    <li ><a href="#method-i-load_iap">#load_iap</a>
    
    <li ><a href="#method-i-load_iap_family">#load_iap_family</a>
    
    <li ><a href="#method-i-load_recurring_iap_pricing">#load_recurring_iap_pricing</a>
    
    <li ><a href="#method-i-members">#members</a>
    
    <li ><a href="#method-i-prepare_app_submissions">#prepare_app_submissions</a>
    
    <li ><a href="#method-i-price_tier">#price_tier</a>
    
    <li ><a href="#method-i-pricing_tiers">#pricing_tiers</a>
    
    <li ><a href="#method-i-ref_data">#ref_data</a>
    
    <li ><a href="#method-i-reinvite_member">#reinvite_member</a>
    
    <li ><a href="#method-i-reject-21">#reject!</a>
    
    <li ><a href="#method-i-release-21">#release!</a>
    
    <li ><a href="#method-i-release_to_all_users-21">#release_to_all_users!</a>
    
    <li ><a href="#method-i-remove_testflight_build_from_review-21">#remove_testflight_build_from_review!</a>
    
    <li ><a href="#method-i-sandbox_testers">#sandbox_testers</a>
    
    <li ><a href="#method-i-select_team">#select_team</a>
    
    <li ><a href="#method-i-send_app_submission">#send_app_submission</a>
    
    <li ><a href="#method-i-send_login_request">#send_login_request</a>
    
    <li ><a href="#method-i-sso_token_for_image">#sso_token_for_image</a>
    
    <li ><a href="#method-i-sso_token_for_video">#sso_token_for_video</a>
    
    <li ><a href="#method-i-submit_iap-21">#submit_iap!</a>
    
    <li ><a href="#method-i-submit_testflight_build_for_review-21">#submit_testflight_build_for_review!</a>
    
    <li ><a href="#method-i-subscription_pricing_tiers">#subscription_pricing_tiers</a>
    
    <li ><a href="#method-i-supported_countries">#supported_countries</a>
    
    <li ><a href="#method-i-supported_territories">#supported_territories</a>
    
    <li ><a href="#method-i-time_series_analytics">#time_series_analytics</a>
    
    <li ><a href="#method-i-transform_to_raw_pricing_intervals">#transform_to_raw_pricing_intervals</a>
    
    <li ><a href="#method-i-update_app_details-21">#update_app_details!</a>
    
    <li ><a href="#method-i-update_app_version-21">#update_app_version!</a>
    
    <li ><a href="#method-i-update_availability-21">#update_availability!</a>
    
    <li ><a href="#method-i-update_build_information-21">#update_build_information!</a>
    
    <li ><a href="#method-i-update_build_trains-21">#update_build_trains!</a>
    
    <li ><a href="#method-i-update_iap-21">#update_iap!</a>
    
    <li ><a href="#method-i-update_iap_family-21">#update_iap_family!</a>
    
    <li ><a href="#method-i-update_member_roles-21">#update_member_roles!</a>
    
    <li ><a href="#method-i-update_price_tier-21">#update_price_tier!</a>
    
    <li ><a href="#method-i-update_recurring_iap_pricing-21">#update_recurring_iap_pricing!</a>
    
    <li ><a href="#method-i-update_tester_from_app-21">#update_tester_from_app!</a>
    
    <li ><a href="#method-i-upload_geojson">#upload_geojson</a>
    
    <li ><a href="#method-i-upload_large_icon">#upload_large_icon</a>
    
    <li ><a href="#method-i-upload_messages_screenshot">#upload_messages_screenshot</a>
    
    <li ><a href="#method-i-upload_purchase_review_screenshot">#upload_purchase_review_screenshot</a>
    
    <li ><a href="#method-i-upload_screenshot">#upload_screenshot</a>
    
    <li ><a href="#method-i-upload_trailer">#upload_trailer</a>
    
    <li ><a href="#method-i-upload_trailer_preview">#upload_trailer_preview</a>
    
    <li ><a href="#method-i-upload_watch_icon">#upload_watch_icon</a>
    
    <li ><a href="#method-i-user_detail_data">#user_detail_data</a>
    
    <li ><a href="#method-i-version_states_history">#version_states_history</a>
    
    <li ><a href="#method-i-versions_history">#versions_history</a>
    
    <li ><a href="#method-i-with_tunes_retry">#with_tunes_retry</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Spaceship::TunesClient">
  <h1 id="class-Spaceship::TunesClient" class="class">
    class Spaceship::TunesClient
  </h1>

  <section class="description">
    
<p>rubocop:disable Metrics/ClassLength</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="ITunesConnectError">ITunesConnectError
        
        <dd><p>Legacy support</p>
        
      
        <dt id="ITunesConnectPotentialServerError">ITunesConnectPotentialServerError
        
        <dd>
        
      
        <dt id="ITunesConnectTemporaryError">ITunesConnectTemporaryError
        
        <dd>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-du_client" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">du_client</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-hostname" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hostname</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group Init and Login</p>
          
          

          
          <div class="method-source-code" id="hostname-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">hostname</span>
  <span class="ruby-string">&quot;https://appstoreconnect.apple.com/WebObjects/iTunesConnect.woa/&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Client.html#method-c-new">Spaceship::Client.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 23</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>
  <span class="ruby-keyword">super</span>

  <span class="ruby-ivar">@du_client</span> = <span class="ruby-constant">DUClient</span>.<span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-video_preview_resolution_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">video_preview_resolution_for</span><span
            class="method-args">(device, is_portrait)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>trailer preview screenshots are required to have a specific size</p>
          
          

          
          <div class="method-source-code" id="video_preview_resolution_for-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 31</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">video_preview_resolution_for</span>(<span class="ruby-identifier">device</span>, <span class="ruby-identifier">is_portrait</span>)
  <span class="ruby-identifier">resolutions</span> = {
      <span class="ruby-string">&#39;iphone4&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">1136</span>, <span class="ruby-value">640</span>],
      <span class="ruby-string">&#39;iphone6&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">1334</span>, <span class="ruby-value">750</span>],
      <span class="ruby-string">&#39;iphone6Plus&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">2208</span>, <span class="ruby-value">1242</span>],
      <span class="ruby-string">&#39;iphone58&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">2436</span>, <span class="ruby-value">1125</span>],
      <span class="ruby-string">&#39;iphone65&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">2688</span>, <span class="ruby-value">1242</span>],
      <span class="ruby-string">&#39;ipad&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">1024</span>, <span class="ruby-value">768</span>],
      <span class="ruby-string">&#39;ipad105&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">2224</span>, <span class="ruby-value">1668</span>],
      <span class="ruby-string">&#39;ipadPro&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">2732</span>, <span class="ruby-value">2048</span>],
      <span class="ruby-string">&#39;iPadPro11&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">2388</span>, <span class="ruby-value">1668</span>],
      <span class="ruby-string">&#39;iPadPro129&#39;</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">2732</span>, <span class="ruby-value">2048</span>]
  }

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">resolutions</span>[<span class="ruby-identifier">device</span>]
  <span class="ruby-identifier">r</span> = [<span class="ruby-identifier">r</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">r</span>[<span class="ruby-value">0</span>]] <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_portrait</span>
  <span class="ruby-identifier">r</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-all_build_trains" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">all_build_trains</span><span
            class="method-args">(app_id: nil, platform: 'ios')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>All build trains, even if there is no <a
href="TestFlight.html">TestFlight</a></p>
          
          

          
          <div class="method-source-code" id="all_build_trains-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 955</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">all_build_trains</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ios&#39;</span>)
  <span class="ruby-identifier">platform</span> = <span class="ruby-string">&#39;ios&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">platform</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/buildHistory?platform=#{platform}&quot;</span>)
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-all_builds_for_train" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">all_builds_for_train</span><span
            class="method-args">(app_id: nil, train: nil, platform: 'ios')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="all_builds_for_train-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 961</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">all_builds_for_train</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">train</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ios&#39;</span>)
  <span class="ruby-identifier">platform</span> = <span class="ruby-string">&#39;ios&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">platform</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/trains/#{train}/buildHistory?platform=#{platform}&quot;</span>)
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-app_details" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">app_details</span><span
            class="method-args">(app_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="app_details-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">app_details</span>(<span class="ruby-identifier">app_id</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/details&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-app_promocodes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">app_promocodes</span><span
            class="method-args">(app_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group Promo codes</p>
          
          

          
          <div class="method-source-code" id="app_promocodes-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1415</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">app_promocodes</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/promocodes/versions&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&#39;versions&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-app_promocodes_history" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">app_promocodes_history</span><span
            class="method-args">(app_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="app_promocodes_history-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1435</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">app_promocodes_history</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/promocodes/history&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&#39;requests&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-app_version" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">app_version</span><span
            class="method-args">(app_id, is_live, platform: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group AppVersions</p>
          
          

          
          <div class="method-source-code" id="app_version-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">app_version</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">is_live</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>

  <span class="ruby-comment"># First we need to fetch the IDs for the edit / live version</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/overview&quot;</span>)
  <span class="ruby-identifier">platforms</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&#39;platforms&#39;</span>]

  <span class="ruby-identifier">platform</span> = <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Tunes</span><span class="ruby-operator">::</span><span class="ruby-constant">AppVersionCommon</span>.<span class="ruby-identifier">find_platform</span>(<span class="ruby-identifier">platforms</span>, <span class="ruby-identifier">search_platform</span><span class="ruby-operator">:</span> <span class="ruby-identifier">platform</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">platform</span>

  <span class="ruby-identifier">version_id</span> = <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Tunes</span><span class="ruby-operator">::</span><span class="ruby-constant">AppVersionCommon</span>.<span class="ruby-identifier">find_version_id</span>(<span class="ruby-identifier">platform</span>, <span class="ruby-identifier">is_live</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version_id</span>

  <span class="ruby-identifier">version_platform</span> = <span class="ruby-identifier">platform</span>[<span class="ruby-string">&#39;platformString&#39;</span>]

  <span class="ruby-identifier">app_version_data</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version_platform</span><span class="ruby-operator">:</span> <span class="ruby-identifier">version_platform</span>, <span class="ruby-identifier">version_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">version_id</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-app_version_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">app_version_data</span><span
            class="method-args">(app_id, version_platform: nil, version_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="app_version_data-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 420</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">app_version_data</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version_platform</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">version_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;version_platform is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version_platform</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;version_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version_id</span>

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{version_platform}/versions/#{version_id}&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-applications" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">applications</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group Applications</p>
          
          

          
          <div class="method-source-code" id="applications-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 254</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">applications</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-string">&#39;ra/apps/manageyourapps/summary/v2&#39;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&#39;summaries&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-availability" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">availability</span><span
            class="method-args">(app_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="availability-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 728</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">availability</span>(<span class="ruby-identifier">app_id</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/pricing/intervals&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
  <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Tunes</span><span class="ruby-operator">::</span><span class="ruby-constant">Availability</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-available_languages" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">available_languages</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="available_languages-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 756</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">available_languages</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-string">&quot;ra/apps/storePreview/regionCountryLanguage&quot;</span>)
  <span class="ruby-identifier">response</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
  <span class="ruby-identifier">response</span>.<span class="ruby-identifier">flat_map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">region</span><span class="ruby-operator">|</span> <span class="ruby-identifier">region</span>[<span class="ruby-string">&quot;storeFronts&quot;</span>] }
          .<span class="ruby-identifier">flat_map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">storefront</span><span class="ruby-operator">|</span> <span class="ruby-identifier">storefront</span>[<span class="ruby-string">&quot;supportedLocaleCodes&quot;</span>] }
          .<span class="ruby-identifier">uniq</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_details" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_details</span><span
            class="method-args">(app_id: nil, train: nil, build_number: nil, platform: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_details-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 967</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_details</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">train</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">build_number</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{platform || &#39;ios&#39;}/trains/#{train}/builds/#{build_number}/details&quot;</span>)
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_trains" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_trains</span><span
            class="method-args">(app_id, testing_type, tries = 5, platform: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>rubocop:disable Metrics/BlockNesting @param (testing_type) internal or
external</p>
          
          

          
          <div class="method-source-code" id="build_trains-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 901</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_trains</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">testing_type</span>, <span class="ruby-identifier">tries</span> = <span class="ruby-value">5</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>
  <span class="ruby-identifier">url</span> = <span class="ruby-node">&quot;ra/apps/#{app_id}/trains/?testingType=#{testing_type}&quot;</span>
  <span class="ruby-identifier">url</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&amp;platform=#{platform}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">platform</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-identifier">url</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-constant">UnexpectedResponse</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
  <span class="ruby-comment"># Build trains fail randomly very often</span>
  <span class="ruby-comment"># we need to catch those errors and retry</span>
  <span class="ruby-comment"># https://github.com/fastlane/fastlane/issues/6419</span>
  <span class="ruby-identifier">retry_error_messages</span> = [
    <span class="ruby-string">&quot;ITC.response.error.OPERATION_FAILED&quot;</span>,
    <span class="ruby-string">&quot;Internal Server Error&quot;</span>,
    <span class="ruby-string">&quot;Service Unavailable&quot;</span>
  ].<span class="ruby-identifier">freeze</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">retry_error_messages</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">message</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">message</span>) }
    <span class="ruby-identifier">tries</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">tries</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-string">&quot;Received temporary server error from App Store Connect. Retrying the request...&quot;</span>)
      <span class="ruby-identifier">sleep</span>(<span class="ruby-value">3</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-string">&quot;SpecHelper&quot;</span>)
      <span class="ruby-keyword">retry</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-constant">UnexpectedResponse</span>, <span class="ruby-node">&quot;Temporary App Store Connect error: #{ex}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-candidate_builds" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">candidate_builds</span><span
            class="method-args">(app_id, version_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group CandiateBuilds</p>
          
          

          
          <div class="method-source-code" id="candidate_builds-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 890</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">candidate_builds</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version_id</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/versions/#{version_id}/candidateBuilds&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&#39;builds&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_application-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_application!</span><span
            class="method-args">(name: nil, primary_language: nil, version: nil, sku: nil, bundle_id: nil, bundle_id_suffix: nil, company_name: nil, platform: nil, itunes_connect_users: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a new application on <a href="Portal/App.html">App</a> Store
Connect @param name (String): The name of your app as it will appear on the
<a href="Portal/App.html">App</a> Store.</p>

<pre>This can&#39;t be longer than 255 characters.</pre>

<p>@param primary_language (String): If localized app information isn&#39;t
available in an</p>

<pre>App Store territory, the information from your primary language will be used instead.</pre>

<p>@param version *DEPRECATED: Use
`Spaceship::Tunes::Application.ensure_version!` method instead*</p>

<pre>(String): The version number is shown on the App Store and should match the one you used in Xcode.</pre>

<p>@param sku (String): A unique ID for your app that is not visible on the <a
href="Portal/App.html">App</a> Store. @param bundle_id (String): The bundle
ID must match the one you used in Xcode. It</p>

<pre>can&#39;t be changed after you submit your first build.</pre>
          
          

          
          <div class="method-source-code" id="create_application-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 284</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_application!</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">primary_language</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">version</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">sku</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">bundle_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">bundle_id_suffix</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">company_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">itunes_connect_users</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;The `version` parameter is deprecated. Use `Spaceship::Tunes::Application.ensure_version!` method instead&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">version</span>

  <span class="ruby-comment"># First, we need to fetch the data from Apple, which we then modify with the user&#39;s values</span>
  <span class="ruby-identifier">primary_language</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;English&quot;</span>
  <span class="ruby-identifier">platform</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;ios&quot;</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/create/v2/?platformString=#{platform}&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)

  <span class="ruby-comment"># Now fill in the values we have</span>
  <span class="ruby-comment"># some values are nil, that&#39;s why there is a hash</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;name&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">name</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;bundleId&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">bundle_id</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;primaryLanguage&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">primary_language</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;primaryLocaleCode&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">primary_language</span>.<span class="ruby-identifier">to_itc_locale</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;vendorId&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">sku</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;bundleIdSuffix&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">bundle_id_suffix</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;companyName&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">company_name</span> } <span class="ruby-keyword">if</span> <span class="ruby-identifier">company_name</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;enabledPlatformsForCreation&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">platform</span>] }

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;initialPlatform&#39;</span>] = <span class="ruby-identifier">platform</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;enabledPlatformsForCreation&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">platform</span>] }

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">itunes_connect_users</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;iTunesConnectUsers&#39;</span>][<span class="ruby-string">&#39;grantedAllUsers&#39;</span>] = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;iTunesConnectUsers&#39;</span>][<span class="ruby-string">&#39;grantedUsers&#39;</span>] = <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;iTunesConnectUsers&#39;</span>][<span class="ruby-string">&#39;availableUsers&#39;</span>].<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span> <span class="ruby-identifier">itunes_connect_users</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">user</span>[<span class="ruby-string">&#39;username&#39;</span>]) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Now send back the modified hash</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-string">&#39;ra/apps/create/v2&#39;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_iap-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_iap!</span><span
            class="method-args">(app_id: nil, type: nil, versions: nil, reference_name: nil, product_id: nil, cleared_for_sale: true, review_notes: nil, review_screenshot: nil, pricing_intervals: nil, family_id: nil, subscription_duration: nil, subscription_free_trial: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates an In-App-Purchases</p>
          
          

          
          <div class="method-source-code" id="create_iap-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1287</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_iap!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">versions</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">reference_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">product_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">cleared_for_sale</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">review_notes</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">review_screenshot</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">pricing_intervals</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">family_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">subscription_duration</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">subscription_free_trial</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-comment"># Load IAP Template based on Type</span>
  <span class="ruby-identifier">type</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;consumable&quot;</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/#{type}/template&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)

  <span class="ruby-comment"># Now fill in the values we have</span>
  <span class="ruby-comment"># some values are nil, that&#39;s why there is a hash</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;familyId&#39;</span>] = <span class="ruby-identifier">family_id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">family_id</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;productId&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">product_id</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;referenceName&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">reference_name</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;clearedForSale&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">cleared_for_sale</span> }

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;pricingDurationType&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">subscription_duration</span> } <span class="ruby-keyword">if</span> <span class="ruby-identifier">subscription_duration</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;freeTrialDurationType&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">subscription_free_trial</span> } <span class="ruby-keyword">if</span> <span class="ruby-identifier">subscription_free_trial</span>

  <span class="ruby-comment"># pricing tier</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pricing_intervals</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;pricingIntervals&#39;</span>] = []
    <span class="ruby-identifier">pricing_intervals</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">interval</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;pricingIntervals&#39;</span>] <span class="ruby-operator">&lt;&lt;</span> {
          <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> {
              <span class="ruby-identifier">country</span><span class="ruby-operator">:</span> <span class="ruby-identifier">interval</span>[<span class="ruby-value">:country</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;WW&quot;</span>,
              <span class="ruby-identifier">tierStem</span><span class="ruby-operator">:</span> <span class="ruby-identifier">interval</span>[<span class="ruby-value">:tier</span>].<span class="ruby-identifier">to_s</span>,
              <span class="ruby-identifier">priceTierEndDate</span><span class="ruby-operator">:</span> <span class="ruby-identifier">interval</span>[<span class="ruby-value">:end_date</span>],
              <span class="ruby-identifier">priceTierEffectiveDate</span><span class="ruby-operator">:</span> <span class="ruby-identifier">interval</span>[<span class="ruby-value">:begin_date</span>]
            }
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">versions_array</span> = []
  <span class="ruby-identifier">versions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">versions_array</span> <span class="ruby-operator">&lt;&lt;</span> {
              <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> {
                <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">:description</span>] },
                <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">v</span>[<span class="ruby-value">:name</span>] },
                <span class="ruby-identifier">localeCode</span><span class="ruby-operator">:</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>
              }
    }
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;versions&quot;</span>][<span class="ruby-value">0</span>][<span class="ruby-string">&quot;details&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>] = <span class="ruby-identifier">versions_array</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;versions&#39;</span>][<span class="ruby-value">0</span>][<span class="ruby-string">&quot;reviewNotes&quot;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">review_notes</span> }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">review_screenshot</span>
    <span class="ruby-comment"># Upload Screenshot:</span>
    <span class="ruby-identifier">upload_file</span> = <span class="ruby-constant">UploadFile</span>.<span class="ruby-identifier">from_path</span>(<span class="ruby-identifier">review_screenshot</span>)
    <span class="ruby-identifier">screenshot_data</span> = <span class="ruby-identifier">upload_purchase_review_screenshot</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">upload_file</span>)
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;versions&quot;</span>][<span class="ruby-value">0</span>][<span class="ruby-string">&quot;reviewScreenshot&quot;</span>] = <span class="ruby-identifier">screenshot_data</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Now send back the modified hash</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/iaps&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_iap_family" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_iap_family</span><span
            class="method-args">(app_id: nil, name: nil, product_id: nil, reference_name: nil, versions: [])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="create_iap_family-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1263</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_iap_family</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">product_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">reference_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">versions</span><span class="ruby-operator">:</span> [])
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/family/template&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;activeAddOns&#39;</span>][<span class="ruby-value">0</span>][<span class="ruby-string">&#39;productId&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">product_id</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;activeAddOns&#39;</span>][<span class="ruby-value">0</span>][<span class="ruby-string">&#39;referenceName&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">reference_name</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;name&#39;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">name</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;details&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>] = <span class="ruby-identifier">versions</span>

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/family/&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_member-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_member!</span><span
            class="method-args">(firstname: nil, lastname: nil, email_address: nil, roles: [], apps: [])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="create_member-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 470</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_member!</span>(<span class="ruby-identifier">firstname</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">lastname</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">email_address</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">roles</span><span class="ruby-operator">:</span> [], <span class="ruby-identifier">apps</span><span class="ruby-operator">:</span> [])
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-string">&quot;ra/users/itc/create&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;firstName&quot;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">firstname</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;lastName&quot;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">lastname</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;emailAddress&quot;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">email_address</span> }

  <span class="ruby-identifier">roles</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;admin&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">roles</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;roles&quot;</span>] = []
  <span class="ruby-identifier">roles</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">role</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># find role from template</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;roles&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">template_role</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">template_role</span>[<span class="ruby-string">&quot;value&quot;</span>][<span class="ruby-string">&quot;name&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">role</span>
        <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;roles&quot;</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">template_role</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">apps</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;userSoftwares&quot;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">grantAllSoftware</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">grantedSoftwareAdamIds</span><span class="ruby-operator">:</span> [] } }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;userSoftwares&quot;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">grantAllSoftware</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">grantedSoftwareAdamIds</span><span class="ruby-operator">:</span> <span class="ruby-identifier">apps</span> } }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># send the changes back to Apple</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-string">&quot;ra/users/itc/create&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_sandbox_tester-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_sandbox_tester!</span><span
            class="method-args">(tester_class: nil, email: nil, password: nil, first_name: nil, last_name: nil, country: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="create_sandbox_tester-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1356</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_sandbox_tester!</span>(<span class="ruby-identifier">tester_class</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">email</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">password</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">first_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">last_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">country</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">url</span> = <span class="ruby-identifier">tester_class</span>.<span class="ruby-identifier">url</span>[<span class="ruby-value">:create</span>]
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">url</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = {
      <span class="ruby-identifier">user</span><span class="ruby-operator">:</span> {
        <span class="ruby-identifier">emailAddress</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">email</span> },
        <span class="ruby-identifier">password</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">password</span> },
        <span class="ruby-identifier">confirmPassword</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">password</span> },
        <span class="ruby-identifier">firstName</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">first_name</span> },
        <span class="ruby-identifier">lastName</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">last_name</span> },
        <span class="ruby-identifier">storeFront</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">country</span> },
        <span class="ruby-identifier">birthDay</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span> },
        <span class="ruby-identifier">birthMonth</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span> },
        <span class="ruby-identifier">secretQuestion</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">hex</span> },
        <span class="ruby-identifier">secretAnswer</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">hex</span> },
        <span class="ruby-identifier">sandboxAccount</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
      }
    }.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">response_object</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
  <span class="ruby-identifier">errors</span> = <span class="ruby-identifier">response_object</span>[<span class="ruby-string">&#39;sectionErrorKeys&#39;</span>]
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ITunesConnectError</span>, <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">response_object</span>[<span class="ruby-string">&#39;user&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_version-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_version!</span><span
            class="method-args">(app_id, version_number, platform = 'ios')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="create_version-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 323</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_version!</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version_number</span>, <span class="ruby-identifier">platform</span> = <span class="ruby-string">&#39;ios&#39;</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{platform}/versions/create/&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = {
      <span class="ruby-identifier">version</span><span class="ruby-operator">:</span> {
        <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">version_number</span>.<span class="ruby-identifier">to_s</span>
      }
    }.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_iap-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_iap!</span><span
            class="method-args">(app_id: nil, purchase_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Deletes a In-App-Purchases</p>
          
          

          
          <div class="method-source-code" id="delete_iap-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1185</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_iap!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">purchase_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:delete</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/#{purchase_id}&quot;</span>)
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_member-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_member!</span><span
            class="method-args">(user_id, email)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="delete_member-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 457</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_member!</span>(<span class="ruby-identifier">user_id</span>, <span class="ruby-identifier">email</span>)
  <span class="ruby-identifier">payload</span> = []
  <span class="ruby-identifier">payload</span> <span class="ruby-operator">&lt;&lt;</span> {
    <span class="ruby-identifier">dsId</span><span class="ruby-operator">:</span> <span class="ruby-identifier">user_id</span>,
    <span class="ruby-identifier">email</span><span class="ruby-operator">:</span> <span class="ruby-identifier">email</span>
  }
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-string">&quot;ra/users/itc/delete&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">payload</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_sandbox_testers-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_sandbox_testers!</span><span
            class="method-args">(tester_class, emails)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="delete_sandbox_testers-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1383</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_sandbox_testers!</span>(<span class="ruby-identifier">tester_class</span>, <span class="ruby-identifier">emails</span>)
  <span class="ruby-identifier">url</span> = <span class="ruby-identifier">tester_class</span>.<span class="ruby-identifier">url</span>[<span class="ruby-value">:delete</span>]
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">url</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">emails</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">email</span><span class="ruby-operator">|</span>
      {
        <span class="ruby-identifier">emailAddress</span><span class="ruby-operator">:</span> {
          <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">email</span>
        }
      }
    <span class="ruby-keyword">end</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-fetch_errors_in_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fetch_errors_in_data</span><span
            class="method-args">(data_section: nil, sub_section_name: nil, keys: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sometimes we get errors or info nested in our data This method allows you
to pass in a set of keys to check for along with the name of the
sub_section of your original data where we should check Returns a mapping
of keys to data array if we find anything, otherwise, empty map</p>
          
          

          
          <div class="method-source-code" id="fetch_errors_in_data-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 139</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fetch_errors_in_data</span>(<span class="ruby-identifier">data_section</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">sub_section_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">keys</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">data_section</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sub_section_name</span>
    <span class="ruby-identifier">sub_section</span> = <span class="ruby-identifier">data_section</span>[<span class="ruby-identifier">sub_section_name</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">sub_section</span> = <span class="ruby-identifier">data_section</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_section</span>
    <span class="ruby-keyword">return</span> {}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">error_map</span> = {}
  <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">errors</span> = <span class="ruby-identifier">sub_section</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-identifier">key</span>, [])
    <span class="ruby-identifier">error_map</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">errors</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">error_map</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-generate_app_version_promocodes-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">generate_app_version_promocodes!</span><span
            class="method-args">(app_id: nil, version_id: nil, quantity: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="generate_app_version_promocodes-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1420</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">generate_app_version_promocodes!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">version_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">quantity</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">data</span> = [{
    <span class="ruby-identifier">numberOfCodes</span><span class="ruby-operator">:</span> <span class="ruby-identifier">quantity</span>,
    <span class="ruby-identifier">agreedToContract</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-identifier">versionId</span><span class="ruby-operator">:</span> <span class="ruby-identifier">version_id</span>
  }]
  <span class="ruby-identifier">url</span> = <span class="ruby-node">&quot;ra/apps/#{app_id}/promocodes/versions&quot;</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">url</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_available_bundle_ids" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_available_bundle_ids</span><span
            class="method-args">(platform: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_available_bundle_ids-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 338</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_available_bundle_ids</span>(<span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">platform</span> <span class="ruby-operator">||=</span> <span class="ruby-string">&quot;ios&quot;</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/create/v2/?platformString=#{platform}&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&#39;bundleIds&#39;</span>].<span class="ruby-identifier">keys</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_build_info_for_review" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_build_info_for_review</span><span
            class="method-args">(app_id: nil, train: nil, build_number: nil, platform: 'ios')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>rubocop:enable Metrics/ParameterLists</p>
          
          

          
          <div class="method-source-code" id="get_build_info_for_review-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1074</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_build_info_for_review</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">train</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">build_number</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ios&#39;</span>)
  <span class="ruby-identifier">url</span> = <span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{platform}/trains/#{train}/builds/#{build_number}/testInformation&quot;</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">url</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)

  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>[<span class="ruby-string">&#39;data&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_ratings" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_ratings</span><span
            class="method-args">(app_id, platform, version_id = '', storefront = '')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_ratings-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 350</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_ratings</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">platform</span>, <span class="ruby-identifier">version_id</span> = <span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">storefront</span> = <span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-comment"># if storefront or version_id is empty api fails</span>
  <span class="ruby-identifier">rating_url</span> = <span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{platform}/reviews/summary&quot;</span>
  <span class="ruby-identifier">params</span> = {}
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;storefront&#39;</span>] = <span class="ruby-identifier">storefront</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">storefront</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;version_id&#39;</span>] = <span class="ruby-identifier">version_id</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version_id</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-identifier">rating_url</span>, <span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_resolution_center" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_resolution_center</span><span
            class="method-args">(app_id, platform)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_resolution_center-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 345</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_resolution_center</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">platform</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{platform}/resolutionCenter?v=latest&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_reviews" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_reviews</span><span
            class="method-args">(app_id, platform, storefront, version_id, upto_date = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_reviews-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 361</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_reviews</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">platform</span>, <span class="ruby-identifier">storefront</span>, <span class="ruby-identifier">version_id</span>, <span class="ruby-identifier">upto_date</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">index</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">per_page</span> = <span class="ruby-value">100</span> <span class="ruby-comment"># apple default</span>
  <span class="ruby-identifier">all_reviews</span> = []

  <span class="ruby-identifier">upto_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">upto_date</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">upto_date</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">rating_url</span> = <span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{platform}/reviews?&quot;</span>
    <span class="ruby-identifier">rating_url</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;sort=REVIEW_SORT_ORDER_MOST_RECENT&quot;</span>
    <span class="ruby-identifier">rating_url</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&amp;index=#{index}&quot;</span>
    <span class="ruby-identifier">rating_url</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&amp;storefront=#{storefront}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">storefront</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">rating_url</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&amp;version_id=#{version_id}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version_id</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-identifier">rating_url</span>)
    <span class="ruby-identifier">all_reviews</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&#39;reviews&#39;</span>])

    <span class="ruby-comment"># The following lines throw errors when there are no reviews so exit out of the loop before them if the app has no reviews</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">all_reviews</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>

    <span class="ruby-identifier">last_review_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">all_reviews</span>[<span class="ruby-value">-1</span>][<span class="ruby-string">&#39;value&#39;</span>][<span class="ruby-string">&#39;lastModified&#39;</span>] <span class="ruby-operator">/</span> <span class="ruby-value">1000</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">upto_date</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">last_review_date</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">upto_date</span>
      <span class="ruby-identifier">all_reviews</span> = <span class="ruby-identifier">all_reviews</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">review</span><span class="ruby-operator">|</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">review</span>[<span class="ruby-string">&#39;value&#39;</span>][<span class="ruby-string">&#39;lastModified&#39;</span>] <span class="ruby-operator">/</span> <span class="ruby-value">1000</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">upto_date</span> }
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">all_reviews</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&#39;reviewCount&#39;</span>]
      <span class="ruby-identifier">index</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">per_page</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">all_reviews</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-handle_itc_response" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">handle_itc_response</span><span
            class="method-args">(raw, flaky_api_call: false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>rubocop:disable Metrics/PerceivedComplexity If the response is coming from
a flaky api, set flaky_api_call to true so we retry a little. Patience is a
virtue.</p>
          
          

          
          <div class="method-source-code" id="handle_itc_response-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 161</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">raw</span>, <span class="ruby-identifier">flaky_api_call</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">raw</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">raw</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)

  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">raw</span>[<span class="ruby-string">&#39;data&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">raw</span> <span class="ruby-comment"># sometimes it&#39;s with data, sometimes it isn&#39;t</span>

  <span class="ruby-identifier">error_keys</span> = [<span class="ruby-string">&quot;sectionErrorKeys&quot;</span>, <span class="ruby-string">&quot;validationErrors&quot;</span>, <span class="ruby-string">&quot;serviceErrors&quot;</span>]
  <span class="ruby-identifier">info_keys</span> = [<span class="ruby-string">&quot;sectionInfoKeys&quot;</span>, <span class="ruby-string">&quot;sectionWarningKeys&quot;</span>]
  <span class="ruby-identifier">error_and_info_keys_to_check</span> = <span class="ruby-identifier">error_keys</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">info_keys</span>

  <span class="ruby-identifier">errors_in_data</span> = <span class="ruby-identifier">fetch_errors_in_data</span>(<span class="ruby-identifier">data_section</span><span class="ruby-operator">:</span> <span class="ruby-identifier">data</span>, <span class="ruby-identifier">keys</span><span class="ruby-operator">:</span> <span class="ruby-identifier">error_and_info_keys_to_check</span>)
  <span class="ruby-identifier">errors_in_version_info</span> = <span class="ruby-identifier">fetch_errors_in_data</span>(<span class="ruby-identifier">data_section</span><span class="ruby-operator">:</span> <span class="ruby-identifier">data</span>, <span class="ruby-identifier">sub_section_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;versionInfo&quot;</span>, <span class="ruby-identifier">keys</span><span class="ruby-operator">:</span> <span class="ruby-identifier">error_and_info_keys_to_check</span>)

  <span class="ruby-comment"># If we have any errors or &quot;info&quot; we need to treat them as warnings or errors</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors_in_data</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">errors_in_version_info</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-string">&quot;Request was successful&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># We pass on the `current_language` so that the error message tells the user</span>
  <span class="ruby-comment"># what language the error was caused in</span>
  <span class="ruby-identifier">handle_response_hash</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>, <span class="ruby-identifier">current_language</span> = <span class="ruby-keyword">nil</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">errors</span> = []
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)
      <span class="ruby-identifier">current_language</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">hash</span>[<span class="ruby-string">&quot;language&quot;</span>]

      <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">errors</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">handle_response_hash</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">current_language</span>)

        <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">key</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;errorKeys&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-comment"># Prepend the error with the language so it&#39;s easier to understand for the user</span>
        <span class="ruby-identifier">errors</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">current_error_message</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">current_language</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;[#{current_language}]: #{current_error_message}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">current_error_message</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>)
      <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">errors</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">handle_response_hash</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">value</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-comment"># else: We don&#39;t care about simple values</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">errors</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">errors</span> = <span class="ruby-identifier">handle_response_hash</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">data</span>)

  <span class="ruby-comment"># Search at data level, as well as &quot;versionInfo&quot; level for errors</span>
  <span class="ruby-identifier">errors_in_data</span> = <span class="ruby-identifier">fetch_errors_in_data</span>(<span class="ruby-identifier">data_section</span><span class="ruby-operator">:</span> <span class="ruby-identifier">data</span>, <span class="ruby-identifier">keys</span><span class="ruby-operator">:</span> <span class="ruby-identifier">error_keys</span>)
  <span class="ruby-identifier">errors_in_version_info</span> = <span class="ruby-identifier">fetch_errors_in_data</span>(<span class="ruby-identifier">data_section</span><span class="ruby-operator">:</span> <span class="ruby-identifier">data</span>, <span class="ruby-identifier">sub_section_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;versionInfo&quot;</span>, <span class="ruby-identifier">keys</span><span class="ruby-operator">:</span> <span class="ruby-identifier">error_keys</span>)

  <span class="ruby-identifier">errors</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">errors_in_data</span>.<span class="ruby-identifier">values</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors_in_data</span>.<span class="ruby-identifier">values</span>
  <span class="ruby-identifier">errors</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">errors_in_version_info</span>.<span class="ruby-identifier">values</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors_in_version_info</span>.<span class="ruby-identifier">values</span>
  <span class="ruby-identifier">errors</span> = <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">flat_map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">value</span> }

  <span class="ruby-comment"># Sometimes there is a different kind of error in the JSON response</span>
  <span class="ruby-comment"># e.g. {&quot;warn&quot;=&gt;nil, &quot;error&quot;=&gt;[&quot;operation_failed&quot;], &quot;info&quot;=&gt;nil}</span>
  <span class="ruby-identifier">different_error</span> = <span class="ruby-identifier">raw</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;messages&#39;</span>, {}).<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;error&#39;</span>, <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">different_error</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">different_error</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-comment"># they are separated by `.` by default</span>
    <span class="ruby-comment"># Sample `error` content: [[&quot;Forbidden&quot;]]</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;You haven&#39;t made any changes.&quot;</span>
      <span class="ruby-comment"># This is a special error which we really don&#39;t care about</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;try again later&quot;</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ITunesConnectTemporaryError</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;Forbidden&quot;</span>)
      <span class="ruby-identifier">raise_insufficient_permission_error!</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">flaky_api_call</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ITunesConnectPotentialServerError</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ITunesConnectError</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Search at data level, as well as &quot;versionInfo&quot; level for info and warnings</span>
  <span class="ruby-identifier">info_in_data</span> = <span class="ruby-identifier">fetch_errors_in_data</span>(<span class="ruby-identifier">data_section</span><span class="ruby-operator">:</span> <span class="ruby-identifier">data</span>, <span class="ruby-identifier">keys</span><span class="ruby-operator">:</span> <span class="ruby-identifier">info_keys</span>)
  <span class="ruby-identifier">info_in_version_info</span> = <span class="ruby-identifier">fetch_errors_in_data</span>(<span class="ruby-identifier">data_section</span><span class="ruby-operator">:</span> <span class="ruby-identifier">data</span>, <span class="ruby-identifier">sub_section_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;versionInfo&quot;</span>, <span class="ruby-identifier">keys</span><span class="ruby-operator">:</span> <span class="ruby-identifier">info_keys</span>)

  <span class="ruby-identifier">info_in_data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">info_key</span>, <span class="ruby-identifier">info_value</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">puts</span>(<span class="ruby-identifier">info_value</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">info_in_version_info</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">info_key</span>, <span class="ruby-identifier">info_value</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">puts</span>(<span class="ruby-identifier">info_value</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-iap_families" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">iap_families</span><span
            class="method-args">(app_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns list of all available Families</p>
          
          

          
          <div class="method-source-code" id="iap_families-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">iap_families</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/families&quot;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>[<span class="ruby-string">&quot;data&quot;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-iap_subscription_pricing_target" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">iap_subscription_pricing_target</span><span
            class="method-args">(app_id: nil, purchase_id: nil, currency: nil, tier: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns pricing goal array</p>
          
          

          
          <div class="method-source-code" id="iap_subscription_pricing_target-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1281</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">iap_subscription_pricing_target</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">purchase_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">currency</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">tier</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/#{purchase_id}/pricing/equalize/#{currency}/#{tier}&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-iaps" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">iaps</span><span
            class="method-args">(app_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns list of all available In-App-Purchases</p>
          
          

          
          <div class="method-source-code" id="iaps-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">iaps</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps&quot;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>[<span class="ruby-string">&quot;data&quot;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-load_iap" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_iap</span><span
            class="method-args">(app_id: nil, purchase_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads the full In-App-Purchases</p>
          
          

          
          <div class="method-source-code" id="load_iap-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1191</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_iap</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">purchase_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/#{purchase_id}&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-load_iap_family" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_iap_family</span><span
            class="method-args">(app_id: nil, family_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads the full In-App-Purchases-Family</p>
          
          

          
          <div class="method-source-code" id="load_iap_family-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1203</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_iap_family</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">family_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/family/#{family_id}&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-load_recurring_iap_pricing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_recurring_iap_pricing</span><span
            class="method-args">(app_id: nil, purchase_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="load_recurring_iap_pricing-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1258</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_recurring_iap_pricing</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">purchase_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/#{purchase_id}/pricing&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-members" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">members</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group Members</p>
          
          

          
          <div class="method-source-code" id="members-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 448</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">members</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-string">&quot;ra/users/itc&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&quot;users&quot;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-prepare_app_submissions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prepare_app_submissions</span><span
            class="method-args">(app_id, version)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group Submit for Review</p>
          
          

          
          <div class="method-source-code" id="prepare_app_submissions-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1089</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prepare_app_submissions</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version</span>

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/versions/#{version}/submit/summary&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-price_tier" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">price_tier</span><span
            class="method-args">(app_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="price_tier-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 645</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">price_tier</span>(<span class="ruby-identifier">app_id</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/pricing/intervals&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;pricingIntervalsFieldTO&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>].<span class="ruby-identifier">first</span>[<span class="ruby-string">&quot;tierStem&quot;</span>]
  <span class="ruby-keyword">rescue</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-pricing_tiers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">pricing_tiers</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an array of all available pricing tiers</p>

<p>@note Although this information is publicly available, the current
spaceship implementation requires you to have a logged in client to access
it</p>

<p>@return [Array] the PricingTier objects (Spaceship::Tunes::PricingTier) [{</p>

<pre>&quot;tierStem&quot;: &quot;0&quot;,
&quot;tierName&quot;: &quot;Free&quot;,
&quot;pricingInfo&quot;: [{
    &quot;country&quot;: &quot;United States&quot;,
    &quot;countryCode&quot;: &quot;US&quot;,
    &quot;currencySymbol&quot;: &quot;$&quot;,
    &quot;currencyCode&quot;: &quot;USD&quot;,
    &quot;wholesalePrice&quot;: 0.0,
    &quot;retailPrice&quot;: 0.0,
    &quot;fRetailPrice&quot;: &quot;$0.00&quot;,
    &quot;fWholesalePrice&quot;: &quot;$0.00&quot;
  }, {
  ...</pre>

<p>}, { …</p>
          
          

          
          <div class="method-source-code" id="pricing_tiers-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 677</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pricing_tiers</span>
  <span class="ruby-ivar">@pricing_tiers</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-string">&#39;ra/apps/pricing/matrix&#39;</span>)
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&#39;pricingTiers&#39;</span>]
    <span class="ruby-identifier">data</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">tier</span><span class="ruby-operator">|</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Tunes</span><span class="ruby-operator">::</span><span class="ruby-constant">PricingTier</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">tier</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ref_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ref_data</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Fetches the <a href="Portal/App.html">App</a> Version Reference information
from ITC @return [AppVersionRef] the response</p>
          
          

          
          <div class="method-source-code" id="ref_data-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 873</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ref_data</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-string">&#39;/WebObjects/iTunesConnect.woa/ra/apps/version/ref&#39;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
  <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Tunes</span><span class="ruby-operator">::</span><span class="ruby-constant">AppVersionRef</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reinvite_member" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reinvite_member</span><span
            class="method-args">(email)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="reinvite_member-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 453</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reinvite_member</span>(<span class="ruby-identifier">email</span>)
  <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>, <span class="ruby-node">&quot;ra/users/itc/#{email}/resendInvitation&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reject-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reject!</span><span
            class="method-args">(app_id, version)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group reject</p>
          
          

          
          <div class="method-source-code" id="reject-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1444</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reject!</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version</span>

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/versions/#{version}/reject&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">app_id</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-release-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">release!</span><span
            class="method-args">(app_id, version)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group release</p>
          
          

          
          <div class="method-source-code" id="release-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1136</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">release!</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version</span>

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/versions/#{version}/releaseToStore&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">app_id</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-release_to_all_users-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">release_to_all_users!</span><span
            class="method-args">(app_id, version)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group release to all users</p>
          
          

          
          <div class="method-source-code" id="release_to_all_users-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1154</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">release_to_all_users!</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version</span>

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/versions/#{version}/phasedRelease/state/COMPLETE&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">app_id</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-remove_testflight_build_from_review-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_testflight_build_from_review!</span><span
            class="method-args">(app_id: nil, train: nil, build_number: nil, platform: 'ios')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="remove_testflight_build_from_review-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 945</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_testflight_build_from_review!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">train</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">build_number</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ios&#39;</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{platform}/trains/#{train}/builds/#{build_number}/reject&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = {}.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sandbox_testers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sandbox_testers</span><span
            class="method-args">(tester_class)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group Sandbox Testers</p>
          
          

          
          <div class="method-source-code" id="sandbox_testers-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1350</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sandbox_testers</span>(<span class="ruby-identifier">tester_class</span>)
  <span class="ruby-identifier">url</span> = <span class="ruby-identifier">tester_class</span>.<span class="ruby-identifier">url</span>[<span class="ruby-value">:index</span>]
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-identifier">url</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select_team" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_team</span><span
            class="method-args">(team_id: nil, team_name: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Shows a team selection for the user in the terminal. This should not be
called on CI systems</p>

<p>@param team_id (String) (optional): The ID of an <a
href="Portal/App.html">App</a> Store Connect team @param team_name (String)
(optional): The name of an <a href="Portal/App.html">App</a> Store Connect
team</p>
          
          

          
          <div class="method-source-code" id="select_team-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 64</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">select_team</span>(<span class="ruby-identifier">team_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">team_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">t_id</span> = (<span class="ruby-identifier">team_id</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;FASTLANE_ITC_TEAM_ID&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">strip</span>
  <span class="ruby-identifier">t_name</span> = (<span class="ruby-identifier">team_name</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;FASTLANE_ITC_TEAM_NAME&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">strip</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">t_name</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">t_id</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">zero?</span> <span class="ruby-comment"># we prefer IDs over names, they are unique</span>
    <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Looking for App Store Connect Team with name #{t_name}&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Globals</span>.<span class="ruby-identifier">verbose?</span>

    <span class="ruby-identifier">teams</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">t_id</span> = <span class="ruby-identifier">t</span>[<span class="ruby-string">&#39;contentProvider&#39;</span>][<span class="ruby-string">&#39;contentProviderId&#39;</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">t</span>[<span class="ruby-string">&#39;contentProvider&#39;</span>][<span class="ruby-string">&#39;name&#39;</span>].<span class="ruby-identifier">casecmp</span>(<span class="ruby-identifier">t_name</span>).<span class="ruby-identifier">zero?</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Could not find team with name &#39;#{t_name}&#39;, trying to fallback to default team&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">t_id</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">zero?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">t_id</span> = <span class="ruby-identifier">teams</span>.<span class="ruby-identifier">first</span>[<span class="ruby-string">&#39;contentProvider&#39;</span>][<span class="ruby-string">&#39;contentProviderId&#39;</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">teams</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">t_id</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Looking for App Store Connect Team with ID #{t_id}&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Globals</span>.<span class="ruby-identifier">verbose?</span>

    <span class="ruby-comment"># actually set the team id here</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">team_id</span> = <span class="ruby-identifier">t_id</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">team_id</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># user didn&#39;t specify a team... #thisiswhywecanthavenicethings</span>
  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;Multiple #{&#39;App Store Connect teams&#39;.yellow} found, please enter the number of the team you want to use: &quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;FASTLANE_HIDE_TEAM_INFORMATION&quot;</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Note: to automatically choose the team, provide either the App Store Connect Team ID, or the Team Name in your fastlane/Appfile:&quot;</span>)
      <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Alternatively you can pass the team name or team ID using the `FASTLANE_ITC_TEAM_ID` or `FASTLANE_ITC_TEAM_NAME` environment variable&quot;</span>)
      <span class="ruby-identifier">first_team</span> = <span class="ruby-identifier">teams</span>.<span class="ruby-identifier">first</span>[<span class="ruby-string">&quot;contentProvider&quot;</span>]
      <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
      <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;  itc_team_id \&quot;#{first_team[&#39;contentProviderId&#39;]}\&quot;&quot;</span>)
      <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
      <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;or&quot;</span>)
      <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
      <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;  itc_team_name \&quot;#{first_team[&#39;name&#39;]}\&quot;&quot;</span>)
      <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;&quot;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># We&#39;re not using highline here, as spaceship doesn&#39;t have a dependency to fastlane_core or highline</span>
    <span class="ruby-identifier">teams</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">team</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">puts</span>(<span class="ruby-node">&quot;#{i + 1}) \&quot;#{team[&#39;contentProvider&#39;][&#39;name&#39;]}\&quot; (#{team[&#39;contentProvider&#39;][&#39;contentProviderId&#39;]})&quot;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">unless</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Client</span><span class="ruby-operator">::</span><span class="ruby-constant">UserInterface</span>.<span class="ruby-identifier">interactive?</span>
      <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Multiple teams found on App Store Connect, Your Terminal is running in non-interactive mode! Cannot continue from here.&quot;</span>)
      <span class="ruby-identifier">puts</span>(<span class="ruby-string">&quot;Please check that you set FASTLANE_ITC_TEAM_ID or FASTLANE_ITC_TEAM_NAME to the right value.&quot;</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Multiple App Store Connect Teams found; unable to choose, terminal not interactive!&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">selected</span> = (<span class="ruby-identifier">$stdin</span>.<span class="ruby-identifier">gets</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">team_to_use</span> = <span class="ruby-identifier">teams</span>[<span class="ruby-identifier">selected</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">selected</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">team_to_use</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">team_id</span> = <span class="ruby-identifier">team_to_use</span>[<span class="ruby-string">&#39;contentProvider&#39;</span>][<span class="ruby-string">&#39;contentProviderId&#39;</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-comment"># actually set the team id here</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">team_id</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-send_app_submission" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">send_app_submission</span><span
            class="method-args">(app_id, version, data)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="send_app_submission-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1102</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_app_submission</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>

  <span class="ruby-comment"># ra/apps/1039164429/version/submit/complete</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/versions/#{version}/submit/complete&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)

  <span class="ruby-comment"># App Store Connect still returns a success status code even the submission</span>
  <span class="ruby-comment"># was failed because of Ad ID Info / Export Compliance. This checks for any section error</span>
  <span class="ruby-comment"># keys in returned adIdInfo / exportCompliance and prints them out.</span>
  <span class="ruby-identifier">ad_id_error_keys</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;data&#39;</span>).<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;adIdInfo&#39;</span>).<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;sectionErrorKeys&#39;</span>)
  <span class="ruby-identifier">export_error_keys</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;data&#39;</span>).<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;exportCompliance&#39;</span>).<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;sectionErrorKeys&#39;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ad_id_error_keys</span>.<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Something wrong with your Ad ID information: #{ad_id_error_keys}.&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">export_error_keys</span>.<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Something wrong with your Export Compliance: #{export_error_keys}&quot;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;messages&#39;</span>).<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;info&#39;</span>).<span class="ruby-identifier">last</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;Successful POST&quot;</span>
    <span class="ruby-comment"># success</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Something went wrong when submitting the app for review. Make sure to pass valid options to submit your app for review&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-send_login_request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">send_login_request</span><span
            class="method-args">(user, password)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="send_login_request-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 125</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_login_request</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">password</span>)
  <span class="ruby-identifier">clear_user_cached_data</span>
  <span class="ruby-identifier">result</span> = <span class="ruby-identifier">send_shared_login_request</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">password</span>)

  <span class="ruby-identifier">store_cookie</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-submit_iap-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">submit_iap!</span><span
            class="method-args">(app_id: nil, purchase_id: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Submit the In-App-Purchase for review</p>
          
          

          
          <div class="method-source-code" id="submit_iap-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">submit_iap!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">purchase_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/#{purchase_id}/submission&quot;</span>)
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-submit_testflight_build_for_review-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">submit_testflight_build_for_review!</span><span
            class="method-args">(app_id: nil, train: nil, build_number: nil, platform: 'ios', changelog: nil, description: nil, feedback_email: nil, marketing_url: nil, first_name: nil, last_name: nil, review_email: nil, phone_number: nil, significant_change: false, privacy_policy_url: nil, review_user_name: nil, review_password: nil, review_notes: nil, encryption: false, encryption_updated: false, is_exempt: false, proprietary: false, third_party: false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>rubocop:disable Metrics/ParameterLists</p>
          
          

          
          <div class="method-source-code" id="submit_testflight_build_for_review-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1004</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">submit_testflight_build_for_review!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">train</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">build_number</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ios&#39;</span>,
                                        <span class="ruby-comment"># Required Metadata:</span>
                                        <span class="ruby-identifier">changelog</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">feedback_email</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">marketing_url</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">first_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">last_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">review_email</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">phone_number</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">significant_change</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,

                                        <span class="ruby-comment"># Optional Metadata:</span>
                                        <span class="ruby-identifier">privacy_policy_url</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">review_user_name</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">review_password</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">review_notes</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                                        <span class="ruby-identifier">encryption</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                        <span class="ruby-identifier">encryption_updated</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                        <span class="ruby-identifier">is_exempt</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                        <span class="ruby-identifier">proprietary</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                        <span class="ruby-identifier">third_party</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)

  <span class="ruby-identifier">build_info</span> = <span class="ruby-identifier">get_build_info_for_review</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">train</span><span class="ruby-operator">:</span> <span class="ruby-identifier">train</span>, <span class="ruby-identifier">build_number</span><span class="ruby-operator">:</span> <span class="ruby-identifier">build_number</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-identifier">platform</span>)
  <span class="ruby-comment"># Now fill in the values provided by the user</span>

  <span class="ruby-comment"># First the localized values:</span>
  <span class="ruby-identifier">build_info</span>[<span class="ruby-string">&#39;details&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">current</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">current</span>[<span class="ruby-string">&#39;whatsNew&#39;</span>][<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">changelog</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">changelog</span>
    <span class="ruby-identifier">current</span>[<span class="ruby-string">&#39;description&#39;</span>][<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">description</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">description</span>
    <span class="ruby-identifier">current</span>[<span class="ruby-string">&#39;feedbackEmail&#39;</span>][<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">feedback_email</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">feedback_email</span>
    <span class="ruby-identifier">current</span>[<span class="ruby-string">&#39;marketingUrl&#39;</span>][<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">marketing_url</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">marketing_url</span>
    <span class="ruby-identifier">current</span>[<span class="ruby-string">&#39;privacyPolicyUrl&#39;</span>][<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">privacy_policy_url</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">privacy_policy_url</span>
    <span class="ruby-identifier">current</span>[<span class="ruby-string">&#39;pageLanguageValue&#39;</span>] = <span class="ruby-identifier">current</span>[<span class="ruby-string">&#39;language&#39;</span>] <span class="ruby-comment"># There is no valid reason why we need this, only iTC being iTC</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">review_info</span> = {
    <span class="ruby-string">&quot;significantChange&quot;</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">significant_change</span>
    },
    <span class="ruby-string">&quot;buildTestInformationTO&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">build_info</span>,
    <span class="ruby-string">&quot;exportComplianceTO&quot;</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;usesEncryption&quot;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">encryption</span>
      },
      <span class="ruby-string">&quot;encryptionUpdated&quot;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">encryption_updated</span>
      },
      <span class="ruby-string">&quot;isExempt&quot;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">is_exempt</span>
      },
      <span class="ruby-string">&quot;containsProprietaryCryptography&quot;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">proprietary</span>
      },
      <span class="ruby-string">&quot;containsThirdPartyCryptography&quot;</span> =<span class="ruby-operator">&gt;</span> {
        <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">third_party</span>
      }
    }
  }

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span> <span class="ruby-comment"># same URL, but a POST request</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{platform}/trains/#{train}/builds/#{build_number}/review/submit&quot;</span>)

    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">review_info</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-subscription_pricing_tiers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">subscription_pricing_tiers</span><span
            class="method-args">(app_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads the full In-App-Purchases-Pricing-Matrix</p>

<pre>note: the matrix is the same for any app_id</pre>

<p>@param app_id (String) The Apple ID of any app @return
([Spaceship::Tunes::IAPSubscriptionPricingTier]) An array of pricing tiers</p>
          
          

          
          <div class="method-source-code" id="subscription_pricing_tiers-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">subscription_pricing_tiers</span>(<span class="ruby-identifier">app_id</span>)
  <span class="ruby-ivar">@subscription_pricing_tiers</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/pricing/matrix/recurring&quot;</span>)
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&quot;data&quot;</span>)[<span class="ruby-string">&quot;pricingTiers&quot;</span>]
    <span class="ruby-identifier">data</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">tier</span><span class="ruby-operator">|</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Tunes</span><span class="ruby-operator">::</span><span class="ruby-constant">IAPSubscriptionPricingTier</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">tier</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supported_countries" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supported_countries</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>An array of supported countries [{</p>

<pre>&quot;code&quot;: &quot;AL&quot;,
&quot;name&quot;: &quot;Albania&quot;,
&quot;region&quot;: &quot;Europe&quot;</pre>

<p>}, { …</p>
          
          

          
          <div class="method-source-code" id="supported_countries-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 751</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">supported_countries</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-string">&quot;ra/apps/pricing/supportedCountries&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supported_territories" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supported_territories</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an array of all supported territories</p>

<p>@note Although this information is publicly available, the current
spaceship implementation requires you to have a logged in client to access
it</p>

<p>@return [Array] the Territory objects (Spaceship::Tunes::Territory)</p>
          
          

          
          <div class="method-source-code" id="supported_territories-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 739</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">supported_territories</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">supported_countries</span>
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">country</span><span class="ruby-operator">|</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Tunes</span><span class="ruby-operator">::</span><span class="ruby-constant">Territory</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">country</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-time_series_analytics" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">time_series_analytics</span><span
            class="method-args">(app_ids, measures, start_time, end_time, frequency, view_by)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group AppAnalytics</p>
          
          

          
          <div class="method-source-code" id="time_series_analytics-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 540</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">time_series_analytics</span>(<span class="ruby-identifier">app_ids</span>, <span class="ruby-identifier">measures</span>, <span class="ruby-identifier">start_time</span>, <span class="ruby-identifier">end_time</span>, <span class="ruby-identifier">frequency</span>, <span class="ruby-identifier">view_by</span>)
  <span class="ruby-identifier">data</span> = {
    <span class="ruby-identifier">adamId</span><span class="ruby-operator">:</span> <span class="ruby-identifier">app_ids</span>,
    <span class="ruby-identifier">dimensionFilters</span><span class="ruby-operator">:</span> [],
    <span class="ruby-identifier">endTime</span><span class="ruby-operator">:</span> <span class="ruby-identifier">end_time</span>,
    <span class="ruby-identifier">frequency</span><span class="ruby-operator">:</span> <span class="ruby-identifier">frequency</span>,
    <span class="ruby-identifier">group</span><span class="ruby-operator">:</span> <span class="ruby-identifier">group_for_view_by</span>(<span class="ruby-identifier">view_by</span>, <span class="ruby-identifier">measures</span>),
    <span class="ruby-identifier">measures</span><span class="ruby-operator">:</span> <span class="ruby-identifier">measures</span>,
    <span class="ruby-identifier">startTime</span><span class="ruby-operator">:</span> <span class="ruby-identifier">start_time</span>
  }

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-string">&quot;https://analytics.itunes.apple.com/analytics/api/v1/data/time-series&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;X-Requested-By&#39;</span>] = <span class="ruby-string">&#39;analytics.itunes.apple.com&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-transform_to_raw_pricing_intervals" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">transform_to_raw_pricing_intervals</span><span
            class="method-args">(app_id = nil, purchase_id = nil, pricing_intervals = nil, subscription_price_target = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="transform_to_raw_pricing_intervals-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 600</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">transform_to_raw_pricing_intervals</span>(<span class="ruby-identifier">app_id</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">purchase_id</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">pricing_intervals</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">subscription_price_target</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">intervals_array</span> = []
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pricing_intervals</span>
    <span class="ruby-identifier">intervals_array</span> = <span class="ruby-identifier">pricing_intervals</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">interval</span><span class="ruby-operator">|</span>
      {
        <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span>  {
          <span class="ruby-string">&quot;tierStem&quot;</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-identifier">interval</span>[<span class="ruby-value">:tier</span>],
          <span class="ruby-string">&quot;priceTierEffectiveDate&quot;</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-identifier">interval</span>[<span class="ruby-value">:begin_date</span>],
          <span class="ruby-string">&quot;priceTierEndDate&quot;</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-identifier">interval</span>[<span class="ruby-value">:end_date</span>],
          <span class="ruby-string">&quot;country&quot;</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-identifier">interval</span>[<span class="ruby-value">:country</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;WW&quot;</span>,
          <span class="ruby-string">&quot;grandfathered&quot;</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-identifier">interval</span>[<span class="ruby-value">:grandfathered</span>]
        }
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">subscription_price_target</span>
    <span class="ruby-identifier">pricing_calculator</span> = <span class="ruby-identifier">iap_subscription_pricing_target</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">purchase_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">purchase_id</span>, <span class="ruby-identifier">currency</span><span class="ruby-operator">:</span> <span class="ruby-identifier">subscription_price_target</span>[<span class="ruby-value">:currency</span>], <span class="ruby-identifier">tier</span><span class="ruby-operator">:</span> <span class="ruby-identifier">subscription_price_target</span>[<span class="ruby-value">:tier</span>])
    <span class="ruby-identifier">intervals_array</span> = <span class="ruby-identifier">pricing_calculator</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">language_code</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">existing_interval</span> =
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">pricing_intervals</span>
          <span class="ruby-identifier">pricing_intervals</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">interval</span><span class="ruby-operator">|</span> <span class="ruby-identifier">interval</span>[<span class="ruby-value">:country</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">language_code</span> }
        <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">grandfathered</span> =
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">existing_interval</span>
          <span class="ruby-identifier">existing_interval</span>[<span class="ruby-value">:grandfathered</span>].<span class="ruby-identifier">clone</span>
        <span class="ruby-keyword">else</span>
          { <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;FUTURE_NONE&quot;</span> }
        <span class="ruby-keyword">end</span>

      {
        <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> {
          <span class="ruby-string">&quot;tierStem&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>[<span class="ruby-string">&quot;tierStem&quot;</span>],
          <span class="ruby-string">&quot;priceTierEffectiveDate&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>[<span class="ruby-string">&quot;priceTierEffectiveDate&quot;</span>],
          <span class="ruby-string">&quot;priceTierEndDate&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>[<span class="ruby-string">&quot;priceTierEndDate&quot;</span>],
          <span class="ruby-string">&quot;country&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">language_code</span>,
          <span class="ruby-string">&quot;grandfathered&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">grandfathered</span>
        }
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">intervals_array</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_app_details-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_app_details!</span><span
            class="method-args">(app_id, data)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update_app_details-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 264</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_app_details!</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/details&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_app_version-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_app_version!</span><span
            class="method-args">(app_id, version_id, data)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update_app_version-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 429</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_app_version!</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">version_id</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;version_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">version_id</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>

  <span class="ruby-identifier">with_tunes_retry</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/ios/versions/#{version_id}&quot;</span>)
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>, <span class="ruby-identifier">flaky_api_call</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_availability-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_availability!</span><span
            class="method-args">(app_id, availability)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group Availability</p>

<p>Updates the availability</p>

<p>@note Although this information is publicly available, the current
spaceship implementation requires you to have a logged in client to access
it @param app_id (String): The id of your app @param availability
(Availability): The availability update</p>

<p>@return [Spaceship::Tunes::Availability] the new Availability</p>
          
          

          
          <div class="method-source-code" id="update_availability-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 695</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_availability!</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">availability</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/pricing/intervals&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;countriesChanged&quot;</span>] = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;countries&quot;</span>] = <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">territories</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">territory</span><span class="ruby-operator">|</span> { <span class="ruby-string">&#39;code&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">territory</span>.<span class="ruby-identifier">code</span> } }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;theWorld&quot;</span>] = <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">include_future_territories</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">include_future_territories</span>

  <span class="ruby-comment"># InitializespreOrder (if needed)</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;preOrder&quot;</span>] <span class="ruby-operator">||=</span> {}

  <span class="ruby-comment"># Sets app_available_date to nil if cleared_for_preorder if false</span>
  <span class="ruby-comment"># This is need for apps that have never set either of these before</span>
  <span class="ruby-comment"># API will error out if cleared_for_preorder is false and app_available_date has a date</span>
  <span class="ruby-identifier">cleared_for_preorder</span> = <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">cleared_for_preorder</span>
  <span class="ruby-identifier">app_available_date</span> = <span class="ruby-identifier">cleared_for_preorder</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">app_available_date</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;b2bAppEnabled&quot;</span>] = <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">b2b_app_enabled</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;educationalDiscount&quot;</span>] = <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">educational_discount</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;preOrder&quot;</span>][<span class="ruby-string">&quot;clearedForPreOrder&quot;</span>] = { <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">cleared_for_preorder</span>, <span class="ruby-string">&quot;isEditable&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;isRequired&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;errorKeys&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;preOrder&quot;</span>][<span class="ruby-string">&quot;appAvailableDate&quot;</span>] = { <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">app_available_date</span>, <span class="ruby-string">&quot;isEditable&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;isRequired&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-string">&quot;errorKeys&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span> }
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;b2bUsers&quot;</span>] = <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">b2b_app_enabled</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">availability</span>.<span class="ruby-identifier">b2b_users</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span> { <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-string">&quot;add&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">add</span>, <span class="ruby-string">&quot;delete&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">delete</span>, <span class="ruby-string">&quot;dsUsername&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">ds_username</span> } } } <span class="ruby-operator">:</span> []

  <span class="ruby-comment"># send the changes back to Apple</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/pricing/intervals&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
  <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Tunes</span><span class="ruby-operator">::</span><span class="ruby-constant">Availability</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_build_information-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_build_information!</span><span
            class="method-args">(app_id: nil, train: nil, build_number: nil, whats_new: nil, description: nil, feedback_email: nil, platform: 'ios')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update_build_information-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 972</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_build_information!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                              <span class="ruby-identifier">train</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                              <span class="ruby-identifier">build_number</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,

                              <span class="ruby-comment"># optional:</span>
                              <span class="ruby-identifier">whats_new</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                              <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                              <span class="ruby-identifier">feedback_email</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>,
                              <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;ios&#39;</span>)
  <span class="ruby-identifier">url</span> = <span class="ruby-node">&quot;ra/apps/#{app_id}/platforms/#{platform}/trains/#{train}/builds/#{build_number}/testInformation&quot;</span>

  <span class="ruby-identifier">build_info</span> = <span class="ruby-identifier">get_build_info_for_review</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">train</span><span class="ruby-operator">:</span> <span class="ruby-identifier">train</span>, <span class="ruby-identifier">build_number</span><span class="ruby-operator">:</span> <span class="ruby-identifier">build_number</span>, <span class="ruby-identifier">platform</span><span class="ruby-operator">:</span> <span class="ruby-identifier">platform</span>)
  <span class="ruby-identifier">build_info</span>[<span class="ruby-string">&quot;details&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">current</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">current</span>[<span class="ruby-string">&quot;whatsNew&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>] = <span class="ruby-identifier">whats_new</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">whats_new</span>
    <span class="ruby-identifier">current</span>[<span class="ruby-string">&quot;description&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>] = <span class="ruby-identifier">description</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">description</span>
    <span class="ruby-identifier">current</span>[<span class="ruby-string">&quot;feedbackEmail&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>] = <span class="ruby-identifier">feedback_email</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">feedback_email</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">review_user_name</span> = <span class="ruby-identifier">build_info</span>[<span class="ruby-string">&#39;reviewUserName&#39;</span>][<span class="ruby-string">&#39;value&#39;</span>]
  <span class="ruby-identifier">review_password</span> = <span class="ruby-identifier">build_info</span>[<span class="ruby-string">&#39;reviewPassword&#39;</span>][<span class="ruby-string">&#39;value&#39;</span>]
  <span class="ruby-identifier">build_info</span>[<span class="ruby-string">&#39;reviewAccountRequired&#39;</span>][<span class="ruby-string">&#39;value&#39;</span>] = (<span class="ruby-identifier">review_user_name</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">review_password</span>.<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>

  <span class="ruby-comment"># Now send everything back to iTC</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span> <span class="ruby-comment"># same URL, but a POST request</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">url</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">build_info</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_build_trains-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_build_trains!</span><span
            class="method-args">(app_id, testing_type, data)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>rubocop:enable Metrics/BlockNesting</p>
          
          

          
          <div class="method-source-code" id="update_build_trains-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 930</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_build_trains!</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">testing_type</span>, <span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_id is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_id</span>

  <span class="ruby-comment"># The request fails if this key is present in the data</span>
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;dailySubmissionCountByPlatform&quot;</span>)

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/testingTypes/#{testing_type}/trains/&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_iap-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_iap!</span><span
            class="method-args">(app_id: nil, purchase_id: nil, data: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>updates an In-App-Purchases</p>
          
          

          
          <div class="method-source-code" id="update_iap-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1234</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_iap!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">purchase_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">with_tunes_retry</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:put</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/#{purchase_id}&quot;</span>)
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_iap_family-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_iap_family!</span><span
            class="method-args">(app_id: nil, family_id: nil, data: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>updates an In-App-Purchases-Family</p>
          
          

          
          <div class="method-source-code" id="update_iap_family-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1222</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_iap_family!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">family_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">data</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">with_tunes_retry</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:put</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/family/#{family_id}/&quot;</span>)
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_member_roles-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_member_roles!</span><span
            class="method-args">(member, roles: [], apps: [])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update_member_roles-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 505</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_member_roles!</span>(<span class="ruby-identifier">member</span>, <span class="ruby-identifier">roles</span><span class="ruby-operator">:</span> [], <span class="ruby-identifier">apps</span><span class="ruby-operator">:</span> [])
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/users/itc/#{member.user_id}/roles&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)

  <span class="ruby-identifier">roles</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;admin&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">roles</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>

  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;roles&quot;</span>] = []
  <span class="ruby-identifier">roles</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">role</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># find role from template</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;roles&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">template_role</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">template_role</span>[<span class="ruby-string">&quot;value&quot;</span>][<span class="ruby-string">&quot;name&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">role</span>
        <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;roles&quot;</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">template_role</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">apps</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;userSoftwares&quot;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">grantAllSoftware</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">grantedSoftwareAdamIds</span><span class="ruby-operator">:</span> [] } }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;user&quot;</span>][<span class="ruby-string">&quot;userSoftwares&quot;</span>] = { <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">grantAllSoftware</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">grantedSoftwareAdamIds</span><span class="ruby-operator">:</span> <span class="ruby-identifier">apps</span> } }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># send the changes back to Apple</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/users/itc/#{member.user_id}/roles&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_price_tier-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_price_tier!</span><span
            class="method-args">(app_id, price_tier)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group Pricing</p>
          
          

          
          <div class="method-source-code" id="update_price_tier-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 565</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_price_tier!</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">price_tier</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/pricing/intervals&quot;</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)

  <span class="ruby-comment"># preOrder isn&#39;t needed for for the request and has some</span>
  <span class="ruby-comment"># values that can cause a failure (invalid dates) so we are removing it</span>
  <span class="ruby-identifier">data</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;preOrder&#39;</span>)

  <span class="ruby-identifier">first_price</span> = (<span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;pricingIntervalsFieldTO&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-comment"># first price</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;pricingIntervalsFieldTO&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;pricingIntervalsFieldTO&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>] <span class="ruby-operator">&lt;&lt;</span> {} <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;pricingIntervalsFieldTO&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>].<span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;pricingIntervalsFieldTO&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>].<span class="ruby-identifier">first</span>[<span class="ruby-string">&quot;tierStem&quot;</span>] = <span class="ruby-identifier">price_tier</span>.<span class="ruby-identifier">to_s</span>

  <span class="ruby-identifier">effective_date</span> = (<span class="ruby-identifier">first_price</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-value">1000</span>)
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;pricingIntervalsFieldTO&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>].<span class="ruby-identifier">first</span>[<span class="ruby-string">&quot;priceTierEffectiveDate&quot;</span>] = <span class="ruby-identifier">effective_date</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;pricingIntervalsFieldTO&quot;</span>][<span class="ruby-string">&quot;value&quot;</span>].<span class="ruby-identifier">first</span>[<span class="ruby-string">&quot;priceTierEndDate&quot;</span>] = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;countriesChanged&quot;</span>] = <span class="ruby-identifier">first_price</span>
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;theWorld&quot;</span>] = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">first_price</span> <span class="ruby-comment"># first price, need to set all countries</span>
    <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;countries&quot;</span>] = <span class="ruby-identifier">supported_countries</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">c</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;region&#39;</span>) <span class="ruby-comment"># we don&#39;t care about le region</span>
      <span class="ruby-identifier">c</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># send the changes back to Apple</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/pricing/intervals&quot;</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_recurring_iap_pricing-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_recurring_iap_pricing!</span><span
            class="method-args">(app_id: nil, purchase_id: nil, pricing_intervals: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update_recurring_iap_pricing-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1245</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_recurring_iap_pricing!</span>(<span class="ruby-identifier">app_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">purchase_id</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">pricing_intervals</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">with_tunes_retry</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">pricing_data</span> = {}
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-node">&quot;ra/apps/#{app_id}/iaps/#{purchase_id}/pricing/subscriptions&quot;</span>)
      <span class="ruby-identifier">pricing_data</span>[<span class="ruby-string">&quot;subscriptions&quot;</span>] = <span class="ruby-identifier">pricing_intervals</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">pricing_data</span>.<span class="ruby-identifier">to_json</span>
      <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">body</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_geojson" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_geojson</span><span
            class="method-args">(app_version, upload_file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Uploads the transit app file @param <a
href="TunesClient.html#method-i-app_version">#app_version</a> (AppVersion):
The version of your app @param upload_file (UploadFile): The image to
upload @return [JSON] the response</p>
          
          

          
          <div class="method-source-code" id="upload_geojson-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 840</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_geojson</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_file</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_version</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;upload_file is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">upload_file</span>

  <span class="ruby-identifier">du_client</span>.<span class="ruby-identifier">upload_geojson</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_file</span>, <span class="ruby-identifier">content_provider_id</span>, <span class="ruby-identifier">sso_token_for_image</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_large_icon" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_large_icon</span><span
            class="method-args">(app_version, upload_image)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group <a href="Portal/App.html">App</a> Icons</p>

<p>Uploads a large icon @param <a
href="TunesClient.html#method-i-app_version">#app_version</a> (AppVersion):
The version of your app @param upload_image (UploadFile): The icon to
upload @return [JSON] the response</p>
          
          

          
          <div class="method-source-code" id="upload_large_icon-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 771</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_large_icon</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_image</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_version</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;upload_image is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">upload_image</span>

  <span class="ruby-identifier">du_client</span>.<span class="ruby-identifier">upload_large_icon</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_image</span>, <span class="ruby-identifier">content_provider_id</span>, <span class="ruby-identifier">sso_token_for_image</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_messages_screenshot" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_messages_screenshot</span><span
            class="method-args">(app_version, upload_image, device)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Uploads an iMessage screenshot @param <a
href="TunesClient.html#method-i-app_version">#app_version</a> (AppVersion):
The version of your app @param upload_image (UploadFile): The image to
upload @param device (string): The target device @return [JSON] the
response</p>
          
          

          
          <div class="method-source-code" id="upload_messages_screenshot-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 828</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_messages_screenshot</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_image</span>, <span class="ruby-identifier">device</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_version</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;upload_image is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">upload_image</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;device is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">device</span>

  <span class="ruby-identifier">du_client</span>.<span class="ruby-identifier">upload_messages_screenshot</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_image</span>, <span class="ruby-identifier">content_provider_id</span>, <span class="ruby-identifier">sso_token_for_image</span>, <span class="ruby-identifier">device</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_purchase_review_screenshot" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_purchase_review_screenshot</span><span
            class="method-args">(app_id, upload_image)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Uploads an In-App-Purchase Review screenshot @param app_id (AppId): The id
of the app @param upload_image (UploadFile): The icon to upload @return
[JSON] the screenshot data, ready to be added to an In-App-Purchase</p>
          
          

          
          <div class="method-source-code" id="upload_purchase_review_screenshot-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 793</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_purchase_review_screenshot</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">upload_image</span>)
  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">du_client</span>.<span class="ruby-identifier">upload_purchase_review_screenshot</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">upload_image</span>, <span class="ruby-identifier">content_provider_id</span>, <span class="ruby-identifier">sso_token_for_image</span>)
  {
      <span class="ruby-string">&quot;value&quot;</span> =<span class="ruby-operator">&gt;</span> {
          <span class="ruby-string">&quot;assetToken&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;token&quot;</span>],
          <span class="ruby-string">&quot;sortOrder&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
          <span class="ruby-string">&quot;type&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">du_client</span>.<span class="ruby-identifier">get_picture_type</span>(<span class="ruby-identifier">upload_image</span>),
          <span class="ruby-string">&quot;originalFileName&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">upload_image</span>.<span class="ruby-identifier">file_name</span>,
          <span class="ruby-string">&quot;size&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;length&quot;</span>],
          <span class="ruby-string">&quot;height&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;height&quot;</span>],
          <span class="ruby-string">&quot;width&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;width&quot;</span>],
          <span class="ruby-string">&quot;checksum&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;md5&quot;</span>]
      }
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_screenshot" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_screenshot</span><span
            class="method-args">(app_version, upload_image, device, is_messages)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Uploads a screenshot @param <a
href="TunesClient.html#method-i-app_version">#app_version</a> (AppVersion):
The version of your app @param upload_image (UploadFile): The image to
upload @param device (string): The target device @param is_messages (Bool):
True if the screenshot is for iMessage @return [JSON] the response</p>
          
          

          
          <div class="method-source-code" id="upload_screenshot-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 815</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_screenshot</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_image</span>, <span class="ruby-identifier">device</span>, <span class="ruby-identifier">is_messages</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_version</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;upload_image is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">upload_image</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;device is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">device</span>

  <span class="ruby-identifier">du_client</span>.<span class="ruby-identifier">upload_screenshot</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_image</span>, <span class="ruby-identifier">content_provider_id</span>, <span class="ruby-identifier">sso_token_for_image</span>, <span class="ruby-identifier">device</span>, <span class="ruby-identifier">is_messages</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_trailer" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_trailer</span><span
            class="method-args">(app_version, upload_trailer)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Uploads the transit app file @param <a
href="TunesClient.html#method-i-app_version">#app_version</a> (AppVersion):
The version of your app @param <a
href="TunesClient.html#method-i-upload_trailer">#upload_trailer</a>
(UploadFile): The trailer to upload @return [JSON] the response</p>
          
          

          
          <div class="method-source-code" id="upload_trailer-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 851</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_trailer</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_trailer</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_version</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;upload_trailer is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">upload_trailer</span>

  <span class="ruby-identifier">du_client</span>.<span class="ruby-identifier">upload_trailer</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_trailer</span>, <span class="ruby-identifier">content_provider_id</span>, <span class="ruby-identifier">sso_token_for_video</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_trailer_preview" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_trailer_preview</span><span
            class="method-args">(app_version, upload_trailer_preview, device)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Uploads the trailer preview @param <a
href="TunesClient.html#method-i-app_version">#app_version</a> (AppVersion):
The version of your app @param <a
href="TunesClient.html#method-i-upload_trailer_preview">#upload_trailer_preview</a>
(UploadFile): The trailer preview to upload @param device (string): The
target device @return [JSON] the response</p>
          
          

          
          <div class="method-source-code" id="upload_trailer_preview-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 863</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_trailer_preview</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_trailer_preview</span>, <span class="ruby-identifier">device</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_version</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;upload_trailer_preview is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">upload_trailer_preview</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;device is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">device</span>

  <span class="ruby-identifier">du_client</span>.<span class="ruby-identifier">upload_trailer_preview</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_trailer_preview</span>, <span class="ruby-identifier">content_provider_id</span>, <span class="ruby-identifier">sso_token_for_image</span>, <span class="ruby-identifier">device</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_watch_icon" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_watch_icon</span><span
            class="method-args">(app_version, upload_image)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Uploads a watch icon @param <a
href="TunesClient.html#method-i-app_version">#app_version</a> (AppVersion):
The version of your app @param upload_image (UploadFile): The icon to
upload @return [JSON] the response</p>
          
          

          
          <div class="method-source-code" id="upload_watch_icon-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 782</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_watch_icon</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_image</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;app_version is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">app_version</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;upload_image is required&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">upload_image</span>

  <span class="ruby-identifier">du_client</span>.<span class="ruby-identifier">upload_watch_icon</span>(<span class="ruby-identifier">app_version</span>, <span class="ruby-identifier">upload_image</span>, <span class="ruby-identifier">content_provider_id</span>, <span class="ruby-identifier">sso_token_for_image</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-user_detail_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_detail_data</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Fetches the User Detail information from ITC. This gets called often and
almost never changes so we cache it @return [UserDetail] the response</p>
          
          

          
          <div class="method-source-code" id="user_detail_data-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 882</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user_detail_data</span>
  <span class="ruby-ivar">@_cached_user_detail_data</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">Tunes</span><span class="ruby-operator">::</span><span class="ruby-constant">UserDetail</span>.<span class="ruby-identifier">factory</span>(<span class="ruby-identifier">user_details_data</span>, <span class="ruby-keyword">self</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-version_states_history" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">version_states_history</span><span
            class="method-args">(app_id, platform, version_id)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="version_states_history-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1407</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">version_states_history</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">platform</span>, <span class="ruby-identifier">version_id</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/versions/#{version_id}/stateHistory?platform=#{platform}&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-versions_history" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">versions_history</span><span
            class="method-args">(app_id, platform)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group State History</p>
          
          

          
          <div class="method-source-code" id="versions_history-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">versions_history</span>(<span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">platform</span>)
  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:get</span>, <span class="ruby-node">&quot;ra/apps/#{app_id}/stateHistory?platform=#{platform}&quot;</span>)
  <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)[<span class="ruby-string">&#39;versions&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-clear_user_cached_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear_user_cached_data</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="clear_user_cached_data-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1484</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear_user_cached_data</span>
  <span class="ruby-ivar">@content_provider_id</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@sso_token_for_image</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@sso_token_for_video</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-content_provider_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">content_provider_id</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>the contentProviderIr found in the UserDetail instance</p>
          
          

          
          <div class="method-source-code" id="content_provider_id-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1491</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">content_provider_id</span>
  <span class="ruby-ivar">@content_provider_id</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">user_detail_data</span>.<span class="ruby-identifier">content_provider_id</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-group_for_view_by" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">group_for_view_by</span><span
            class="method-args">(view_by, measures)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>generates group hash used in the analytics time_series API. Using
rank=DESCENDING and limit=3 as this is what the <a
href="Portal/App.html">App</a> Store Connect analytics dashboard uses.</p>
          
          

          
          <div class="method-source-code" id="group_for_view_by-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1507</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">group_for_view_by</span>(<span class="ruby-identifier">view_by</span>, <span class="ruby-identifier">measures</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">view_by</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">measures</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> {
      <span class="ruby-identifier">metric</span><span class="ruby-operator">:</span> <span class="ruby-identifier">measures</span>.<span class="ruby-identifier">first</span>,
      <span class="ruby-identifier">dimension</span><span class="ruby-operator">:</span> <span class="ruby-identifier">view_by</span>,
      <span class="ruby-identifier">rank</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;DESCENDING&quot;</span>,
      <span class="ruby-identifier">limit</span><span class="ruby-operator">:</span> <span class="ruby-value">3</span>
    }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sso_token_for_image" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sso_token_for_image</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>the ssoTokenForImage found in the AppVersionRef instance</p>
          
          

          
          <div class="method-source-code" id="sso_token_for_image-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1496</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sso_token_for_image</span>
  <span class="ruby-ivar">@sso_token_for_image</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">ref_data</span>.<span class="ruby-identifier">sso_token_for_image</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sso_token_for_video" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sso_token_for_video</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>the ssoTokenForVideo found in the AppVersionRef instance</p>
          
          

          
          <div class="method-source-code" id="sso_token_for_video-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1501</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sso_token_for_video</span>
  <span class="ruby-ivar">@sso_token_for_video</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">ref_data</span>.<span class="ruby-identifier">sso_token_for_video</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_tester_from_app-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_tester_from_app!</span><span
            class="method-args">(tester, app_id, testing)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update_tester_from_app-21-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1520</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_tester_from_app!</span>(<span class="ruby-identifier">tester</span>, <span class="ruby-identifier">app_id</span>, <span class="ruby-identifier">testing</span>)
  <span class="ruby-identifier">url</span> = <span class="ruby-identifier">tester</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">app_id</span>)[<span class="ruby-value">:update_by_app</span>]
  <span class="ruby-identifier">data</span> = {
    <span class="ruby-identifier">users</span><span class="ruby-operator">:</span> [
      {
        <span class="ruby-identifier">emailAddress</span><span class="ruby-operator">:</span> {
          <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tester</span>.<span class="ruby-identifier">email</span>
        },
        <span class="ruby-identifier">firstName</span><span class="ruby-operator">:</span> {
          <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tester</span>.<span class="ruby-identifier">first_name</span>
        },
        <span class="ruby-identifier">lastName</span><span class="ruby-operator">:</span> {
          <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">tester</span>.<span class="ruby-identifier">last_name</span>
        },
        <span class="ruby-identifier">testing</span><span class="ruby-operator">:</span> {
          <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-identifier">testing</span>
        }
      }
    ]
  }

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">request</span>(<span class="ruby-value">:post</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">req</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">url</span>(<span class="ruby-identifier">url</span>)
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">data</span>.<span class="ruby-identifier">to_json</span>
    <span class="ruby-identifier">req</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>] = <span class="ruby-string">&#39;application/json&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">data</span> = <span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">r</span>, <span class="ruby-string">&#39;data&#39;</span>)
  <span class="ruby-identifier">handle_itc_response</span>(<span class="ruby-identifier">data</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_tunes_retry" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_tunes_retry</span><span
            class="method-args">(tries = 5, potential_server_error_tries = 3) { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="with_tunes_retry-source">
            <pre><span class="ruby-comment"># File spaceship/lib/spaceship/tunes/tunes_client.rb, line 1460</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">with_tunes_retry</span>(<span class="ruby-identifier">tries</span> = <span class="ruby-value">5</span>, <span class="ruby-identifier">potential_server_error_tries</span> = <span class="ruby-value">3</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">_block</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">TunesClient</span><span class="ruby-operator">::</span><span class="ruby-constant">ITunesConnectTemporaryError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
  <span class="ruby-identifier">seconds_to_sleep</span> = <span class="ruby-value">60</span>
  <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">tries</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">zero?</span>
    <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;App Store Connect temporary error received: &#39;#{ex.message}&#39;. Retrying after #{seconds_to_sleep} seconds (remaining: #{tries})...&quot;</span>
    <span class="ruby-identifier">puts</span>(<span class="ruby-identifier">msg</span>)
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-identifier">msg</span>)
    <span class="ruby-identifier">sleep</span>(<span class="ruby-identifier">seconds_to_sleep</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-string">&quot;SpecHelper&quot;</span>)
    <span class="ruby-keyword">retry</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-identifier">ex</span> <span class="ruby-comment"># re-raise the exception</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Spaceship</span><span class="ruby-operator">::</span><span class="ruby-constant">TunesClient</span><span class="ruby-operator">::</span><span class="ruby-constant">ITunesConnectPotentialServerError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
  <span class="ruby-identifier">seconds_to_sleep</span> = <span class="ruby-value">10</span>
  <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">potential_server_error_tries</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">zero?</span>
    <span class="ruby-identifier">msg</span> = <span class="ruby-node">&quot;Potential server error received: &#39;#{ex.message}&#39;. Retrying after 10 seconds (remaining: #{potential_server_error_tries})...&quot;</span>
    <span class="ruby-identifier">puts</span>(<span class="ruby-identifier">msg</span>)
    <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-identifier">msg</span>)
    <span class="ruby-identifier">sleep</span>(<span class="ruby-identifier">seconds_to_sleep</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-string">&quot;SpecHelper&quot;</span>)
    <span class="ruby-keyword">retry</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-identifier">ex</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

