<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Supply::Uploader - fastlane-2.116.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-all_languages">#all_languages</a>
    
    <li ><a href="#method-i-check_superseded_tracks">#check_superseded_tracks</a>
    
    <li ><a href="#method-i-client">#client</a>
    
    <li ><a href="#method-i-find_obbs">#find_obbs</a>
    
    <li ><a href="#method-i-metadata_path">#metadata_path</a>
    
    <li ><a href="#method-i-obb_expansion_file_type">#obb_expansion_file_type</a>
    
    <li ><a href="#method-i-perform_upload">#perform_upload</a>
    
    <li ><a href="#method-i-promote_track">#promote_track</a>
    
    <li ><a href="#method-i-update_track">#update_track</a>
    
    <li ><a href="#method-i-upload_apks">#upload_apks</a>
    
    <li ><a href="#method-i-upload_binary_data">#upload_binary_data</a>
    
    <li ><a href="#method-i-upload_bundles">#upload_bundles</a>
    
    <li ><a href="#method-i-upload_changelog">#upload_changelog</a>
    
    <li ><a href="#method-i-upload_changelogs">#upload_changelogs</a>
    
    <li ><a href="#method-i-upload_images">#upload_images</a>
    
    <li ><a href="#method-i-upload_mapping">#upload_mapping</a>
    
    <li ><a href="#method-i-upload_metadata">#upload_metadata</a>
    
    <li ><a href="#method-i-upload_obb">#upload_obb</a>
    
    <li ><a href="#method-i-upload_obbs">#upload_obbs</a>
    
    <li ><a href="#method-i-upload_screenshots">#upload_screenshots</a>
    
    <li ><a href="#method-i-verify_config-21">#verify_config!</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Supply::Uploader">
  <h1 id="class-Supply::Uploader" class="class">
    class Supply::Uploader
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-perform_upload" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">perform_upload</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="perform_upload-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 3</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">perform_upload</span>
  <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">PrintTable</span>.<span class="ruby-identifier">print_values</span>(<span class="ruby-identifier">config</span><span class="ruby-operator">:</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>, <span class="ruby-identifier">hide_keys</span><span class="ruby-operator">:</span> [<span class="ruby-value">:issuer</span>], <span class="ruby-identifier">mask_keys</span><span class="ruby-operator">:</span> [<span class="ruby-value">:json_key_data</span>], <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;Summary for supply #{Fastlane::VERSION}&quot;</span>)

  <span class="ruby-identifier">client</span>.<span class="ruby-identifier">begin_edit</span>(<span class="ruby-identifier">package_name</span><span class="ruby-operator">:</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:package_name</span>])

  <span class="ruby-identifier">verify_config!</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">metadata_path</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">user_error!</span>(<span class="ruby-node">&quot;Could not find folder #{metadata_path}&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">metadata_path</span>)

    <span class="ruby-identifier">all_languages</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">language</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">language</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&#39;.&#39;</span>) <span class="ruby-comment"># e.g. . or .. or hidden folders</span>
      <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Preparing to upload for language &#39;#{language}&#39;...&quot;</span>)

      <span class="ruby-identifier">listing</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">listing_for_language</span>(<span class="ruby-identifier">language</span>)

      <span class="ruby-identifier">upload_metadata</span>(<span class="ruby-identifier">language</span>, <span class="ruby-identifier">listing</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:skip_upload_metadata</span>]
      <span class="ruby-identifier">upload_images</span>(<span class="ruby-identifier">language</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:skip_upload_images</span>]
      <span class="ruby-identifier">upload_screenshots</span>(<span class="ruby-identifier">language</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:skip_upload_screenshots</span>]
      <span class="ruby-identifier">upload_changelogs</span>(<span class="ruby-identifier">language</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:skip_upload_metadata</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">apk_version_codes</span> = []
  <span class="ruby-identifier">apk_version_codes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">upload_apks</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:skip_upload_apk</span>]
  <span class="ruby-identifier">apk_version_codes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">upload_bundles</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:skip_upload_aab</span>]
  <span class="ruby-identifier">upload_mapping</span>(<span class="ruby-identifier">apk_version_codes</span>)

  <span class="ruby-identifier">apk_version_codes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:version_codes_to_retain</span>]) <span class="ruby-keyword">if</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:version_codes_to_retain</span>]

  <span class="ruby-comment"># Only update tracks if we have version codes</span>
  <span class="ruby-comment"># Updating a track with empty version codes can completely clear out a track</span>
  <span class="ruby-identifier">update_track</span>(<span class="ruby-identifier">apk_version_codes</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">apk_version_codes</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">promote_track</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track_promote_to</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:validate_only</span>]
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-string">&quot;Validating all changes with Google Play...&quot;</span>)
    <span class="ruby-identifier">client</span>.<span class="ruby-identifier">validate_current_edit!</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">success</span>(<span class="ruby-string">&quot;Successfully validated the upload to Google Play&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-string">&quot;Uploading all changes to Google Play...&quot;</span>)
    <span class="ruby-identifier">client</span>.<span class="ruby-identifier">commit_current_edit!</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">success</span>(<span class="ruby-string">&quot;Successfully finished the upload to Google Play&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-promote_track" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">promote_track</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="promote_track-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">promote_track</span>
  <span class="ruby-identifier">version_codes</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">track_version_codes</span>(<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track</span>])
  <span class="ruby-comment"># the actual value passed for the rollout argument does not matter because it will be ignored by the Google Play API</span>
  <span class="ruby-comment"># but it has to be between 0.0 and 1.0 to pass the validity check. So we are passing the default value 0.1</span>
  <span class="ruby-identifier">client</span>.<span class="ruby-identifier">update_track</span>(<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track</span>], <span class="ruby-value">0.1</span>, <span class="ruby-keyword">nil</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:deactivate_on_promote</span>]
  <span class="ruby-identifier">client</span>.<span class="ruby-identifier">update_track</span>(<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track_promote_to</span>], <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:rollout</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0.1</span>, <span class="ruby-identifier">version_codes</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_apks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_apks</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="upload_apks-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 134</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_apks</span>
  <span class="ruby-identifier">apk_paths</span> = [<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:apk</span>]] <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">apk_paths</span> = <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:apk_paths</span>])
  <span class="ruby-identifier">apk_paths</span>.<span class="ruby-identifier">compact!</span>

  <span class="ruby-identifier">apk_version_codes</span> = []

  <span class="ruby-identifier">apk_paths</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">apk_path</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">apk_version_codes</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">upload_binary_data</span>(<span class="ruby-identifier">apk_path</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">apk_version_codes</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_bundles" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_bundles</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="upload_bundles-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 156</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_bundles</span>
  <span class="ruby-identifier">aab_paths</span> = [<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:aab</span>]] <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">aab_paths</span> = <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:aab_paths</span>])
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">aab_paths</span>
  <span class="ruby-identifier">aab_paths</span>.<span class="ruby-identifier">compact!</span>

  <span class="ruby-identifier">aab_version_codes</span> = []

  <span class="ruby-identifier">aab_paths</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">aab_path</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Preparing aab at path &#39;#{aab_path}&#39; for upload...&quot;</span>)
    <span class="ruby-identifier">aab_version_codes</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">client</span>.<span class="ruby-identifier">upload_bundle</span>(<span class="ruby-identifier">aab_path</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">aab_version_codes</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_changelog" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_changelog</span><span
            class="method-args">(language, version_code)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="upload_changelog-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_changelog</span>(<span class="ruby-identifier">language</span>, <span class="ruby-identifier">version_code</span>)
  <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">metadata_path</span>, <span class="ruby-identifier">language</span>, <span class="ruby-constant">Supply</span><span class="ruby-operator">::</span><span class="ruby-constant">CHANGELOGS_FOLDER_NAME</span>, <span class="ruby-node">&quot;#{version_code}.txt&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Updating changelog for code version &#39;#{version_code}&#39; and language &#39;#{language}&#39;...&quot;</span>)
    <span class="ruby-identifier">apk_listing</span> = <span class="ruby-constant">ApkListing</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">encoding</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;UTF-8&#39;</span>), <span class="ruby-identifier">language</span>, <span class="ruby-identifier">version_code</span>)
    <span class="ruby-identifier">client</span>.<span class="ruby-identifier">update_apk_listing_for_language</span>(<span class="ruby-identifier">apk_listing</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_changelogs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_changelogs</span><span
            class="method-args">(language)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="upload_changelogs-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_changelogs</span>(<span class="ruby-identifier">language</span>)
  <span class="ruby-identifier">client</span>.<span class="ruby-identifier">apks_version_codes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">apk_version_code</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">upload_changelog</span>(<span class="ruby-identifier">language</span>, <span class="ruby-identifier">apk_version_code</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">client</span>.<span class="ruby-identifier">aab_version_codes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">aab_version_code</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">upload_changelog</span>(<span class="ruby-identifier">language</span>, <span class="ruby-identifier">aab_version_code</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_images" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_images</span><span
            class="method-args">(language)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="upload_images-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_images</span>(<span class="ruby-identifier">language</span>)
  <span class="ruby-constant">Supply</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGES_TYPES</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">image_type</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">search</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">metadata_path</span>, <span class="ruby-identifier">language</span>, <span class="ruby-constant">Supply</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGES_FOLDER_NAME</span>, <span class="ruby-identifier">image_type</span>) <span class="ruby-operator">+</span> <span class="ruby-node">&quot;.#{IMAGE_FILE_EXTENSIONS}&quot;</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">search</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_CASEFOLD</span>).<span class="ruby-identifier">last</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">path</span>

    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Uploading image file #{path}...&quot;</span>)
    <span class="ruby-identifier">client</span>.<span class="ruby-identifier">upload_image</span>(<span class="ruby-identifier">image_path</span><span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>),
                        <span class="ruby-identifier">image_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">image_type</span>,
                          <span class="ruby-identifier">language</span><span class="ruby-operator">:</span> <span class="ruby-identifier">language</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_mapping" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_mapping</span><span
            class="method-args">(apk_version_codes)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="upload_mapping-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 147</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_mapping</span>(<span class="ruby-identifier">apk_version_codes</span>)
  <span class="ruby-identifier">mapping_paths</span> = [<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:mapping</span>]] <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">mapping_paths</span> = <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:mapping_paths</span>])
  <span class="ruby-identifier">mapping_paths</span>.<span class="ruby-identifier">zip</span>(<span class="ruby-identifier">apk_version_codes</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mapping_path</span>, <span class="ruby-identifier">version_code</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">mapping_path</span>
      <span class="ruby-identifier">client</span>.<span class="ruby-identifier">upload_mapping</span>(<span class="ruby-identifier">mapping_path</span>, <span class="ruby-identifier">version_code</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_metadata" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_metadata</span><span
            class="method-args">(language, listing)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="upload_metadata-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_metadata</span>(<span class="ruby-identifier">language</span>, <span class="ruby-identifier">listing</span>)
  <span class="ruby-constant">Supply</span><span class="ruby-operator">::</span><span class="ruby-constant">AVAILABLE_METADATA_FIELDS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">metadata_path</span>, <span class="ruby-identifier">language</span>, <span class="ruby-node">&quot;#{key}.txt&quot;</span>)
    <span class="ruby-identifier">listing</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{key}=&quot;</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">encoding</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;UTF-8&#39;</span>)) <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">listing</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidByteSequenceError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
    <span class="ruby-identifier">message</span> = (<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">capitalize</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">user_error!</span>(<span class="ruby-node">&quot;Metadata must be UTF-8 encoded. #{message}&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_screenshots" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_screenshots</span><span
            class="method-args">(language)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="upload_screenshots-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 117</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_screenshots</span>(<span class="ruby-identifier">language</span>)
  <span class="ruby-constant">Supply</span><span class="ruby-operator">::</span><span class="ruby-constant">SCREENSHOT_TYPES</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">screenshot_type</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">search</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">metadata_path</span>, <span class="ruby-identifier">language</span>, <span class="ruby-constant">Supply</span><span class="ruby-operator">::</span><span class="ruby-constant">IMAGES_FOLDER_NAME</span>, <span class="ruby-identifier">screenshot_type</span>, <span class="ruby-node">&quot;*.#{IMAGE_FILE_EXTENSIONS}&quot;</span>)
    <span class="ruby-identifier">paths</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">search</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_CASEFOLD</span>)
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>

    <span class="ruby-identifier">client</span>.<span class="ruby-identifier">clear_screenshots</span>(<span class="ruby-identifier">image_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">screenshot_type</span>, <span class="ruby-identifier">language</span><span class="ruby-operator">:</span> <span class="ruby-identifier">language</span>)

    <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Uploading screenshot #{path}...&quot;</span>)
      <span class="ruby-identifier">client</span>.<span class="ruby-identifier">upload_image</span>(<span class="ruby-identifier">image_path</span><span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>),
                          <span class="ruby-identifier">image_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">screenshot_type</span>,
                            <span class="ruby-identifier">language</span><span class="ruby-operator">:</span> <span class="ruby-identifier">language</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-verify_config-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">verify_config!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="verify_config-21-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 50</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">verify_config!</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">metadata_path</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:apk</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:apk_paths</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:aab</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:aab_paths</span>] <span class="ruby-operator">||</span> (<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track_promote_to</span>])
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">user_error!</span>(<span class="ruby-string">&quot;No local metadata, apks, aab, or track to promote were found, make sure to run `fastlane supply init` to setup supply&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Can&#39;t upload both at apk and aab at same time</span>
  <span class="ruby-comment"># Need to error out users when there both apks and aabs are detected</span>
  <span class="ruby-identifier">apk_paths</span> = [<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:apk</span>], <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:apk_paths</span>]].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>
  <span class="ruby-identifier">could_upload_apk</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">apk_paths</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:skip_upload_apk</span>]
  <span class="ruby-identifier">could_upload_aab</span> = <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:aab</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:skip_upload_aab</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">could_upload_apk</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">could_upload_aab</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">user_error!</span>(<span class="ruby-string">&quot;Cannot provide both apk(s) and aab - use `skip_upload_apk`, `skip_upload_aab`, or  make sure to remove any existing .apk or .aab files that are no longer needed&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-all_languages" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">all_languages</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>returns only language directories from <a
href="Uploader.html#method-i-metadata_path">#metadata_path</a></p>
          
          

          
          <div class="method-source-code" id="all_languages-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 254</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">all_languages</span>
  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">entries</span>(<span class="ruby-identifier">metadata_path</span>)
     .<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">metadata_path</span>, <span class="ruby-identifier">f</span>)) }
     .<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&#39;.&#39;</span>) }
     .<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">y</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-check_superseded_tracks" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_superseded_tracks</span><span
            class="method-args">(apk_version_codes)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Remove any version codes that is:</p>

<pre>- Lesser than the greatest of any later (i.e. production) track
- Or lesser than the currently being uploaded if it&#39;s in an earlier (i.e. alpha) track</pre>
          
          

          
          <div class="method-source-code" id="check_superseded_tracks-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 215</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_superseded_tracks</span>(<span class="ruby-identifier">apk_version_codes</span>)
  <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Checking superseded tracks, uploading &#39;#{apk_version_codes}&#39; to &#39;#{Supply.config[:track]}&#39;...&quot;</span>)
  <span class="ruby-identifier">max_apk_version_code</span> = <span class="ruby-identifier">apk_version_codes</span>.<span class="ruby-identifier">max</span>
  <span class="ruby-identifier">max_tracks_version_code</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">tracks</span> = [<span class="ruby-string">&quot;production&quot;</span>, <span class="ruby-string">&quot;rollout&quot;</span>, <span class="ruby-string">&quot;beta&quot;</span>, <span class="ruby-string">&quot;alpha&quot;</span>, <span class="ruby-string">&quot;internal&quot;</span>]
  <span class="ruby-identifier">config_track_index</span> = <span class="ruby-identifier">tracks</span>.<span class="ruby-identifier">index</span>(<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track</span>])

  <span class="ruby-comment"># Custom &quot;closed&quot; tracks are now allowed (https://support.google.com/googleplay/android-developer/answer/3131213)</span>
  <span class="ruby-comment"># Custom tracks have an equal level with alpha (alpha is considered a closed track as well)</span>
  <span class="ruby-comment"># If a track index is not found, we will assume is a custom track so an alpha index is given</span>
  <span class="ruby-identifier">config_track_index</span> = <span class="ruby-identifier">tracks</span>.<span class="ruby-identifier">index</span>(<span class="ruby-string">&quot;alpha&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">config_track_index</span>

  <span class="ruby-identifier">tracks</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">track_index</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">track</span> = <span class="ruby-identifier">tracks</span>[<span class="ruby-identifier">track_index</span>]
    <span class="ruby-identifier">track_version_codes</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">track_version_codes</span>(<span class="ruby-identifier">track</span>).<span class="ruby-identifier">sort</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">verbose</span>(<span class="ruby-node">&quot;Found &#39;#{track_version_codes}&#39; on track &#39;#{track}&#39;&quot;</span>)

    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">track_index</span>.<span class="ruby-identifier">eql?</span>(<span class="ruby-identifier">config_track_index</span>)
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">track_version_codes</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">max_tracks_version_code</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">max_tracks_version_code</span> = <span class="ruby-identifier">track_version_codes</span>.<span class="ruby-identifier">max</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">removed_version_codes</span> = <span class="ruby-identifier">track_version_codes</span>.<span class="ruby-identifier">take_while</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">v</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">max_tracks_version_code</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">v</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">max_apk_version_code</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">track_index</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config_track_index</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">removed_version_codes</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-identifier">keep_version_codes</span> = <span class="ruby-identifier">track_version_codes</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">removed_version_codes</span>
    <span class="ruby-identifier">max_tracks_version_code</span> = <span class="ruby-identifier">keep_version_codes</span>[<span class="ruby-value">0</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">keep_version_codes</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">client</span>.<span class="ruby-identifier">update_track</span>(<span class="ruby-identifier">track</span>, <span class="ruby-value">1.0</span>, <span class="ruby-identifier">keep_version_codes</span>)
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Superseded track &#39;#{track}&#39;, removed &#39;#{removed_version_codes}&#39;&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-client" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">client</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="client-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 261</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">client</span>
  <span class="ruby-ivar">@client</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Client</span>.<span class="ruby-identifier">make_from_config</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-find_obbs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_obbs</span><span
            class="method-args">(apk_path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@return a map of the obb paths for that apk keyed by their detected
expansion file type E.g. { &#39;main&#39; =&gt; &#39;path/to/main.obb&#39;,
&#39;patch&#39; =&gt; &#39;path/to/patch.obb&#39; }</p>
          
          

          
          <div class="method-source-code" id="find_obbs-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 285</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_obbs</span>(<span class="ruby-identifier">apk_path</span>)
  <span class="ruby-identifier">search</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">apk_path</span>), <span class="ruby-string">&#39;*.obb&#39;</span>)
  <span class="ruby-identifier">paths</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">search</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">FNM_CASEFOLD</span>)
  <span class="ruby-identifier">expansion_paths</span> = {}
  <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">type</span> = <span class="ruby-identifier">obb_expansion_file_type</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">type</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">expansion_paths</span>[<span class="ruby-identifier">type</span>]
      <span class="ruby-constant">UI</span>.<span class="ruby-identifier">important</span>(<span class="ruby-node">&quot;Can only upload one &#39;#{type}&#39; apk expansion. Skipping obb upload entirely.&quot;</span>)
      <span class="ruby-constant">UI</span>.<span class="ruby-identifier">important</span>(<span class="ruby-string">&quot;If you&#39;d like this to work differently, please submit an issue.&quot;</span>)
      <span class="ruby-keyword">return</span> {}
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">expansion_paths</span>[<span class="ruby-identifier">type</span>] = <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">expansion_paths</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-metadata_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">metadata_path</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="metadata_path-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 265</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">metadata_path</span>
  <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:metadata_path</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-obb_expansion_file_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">obb_expansion_file_type</span><span
            class="method-args">(obb_file_path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="obb_expansion_file_type-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 309</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">obb_expansion_file_type</span>(<span class="ruby-identifier">obb_file_path</span>)
  <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">obb_file_path</span>, <span class="ruby-string">&quot;.obb&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;main&#39;</span>)
    <span class="ruby-string">&#39;main&#39;</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;patch&#39;</span>)
    <span class="ruby-string">&#39;patch&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_track" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_track</span><span
            class="method-args">(apk_version_codes)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="update_track-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">update_track</span>(<span class="ruby-identifier">apk_version_codes</span>)
  <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Updating track &#39;#{Supply.config[:track]}&#39;...&quot;</span>)
  <span class="ruby-identifier">check_superseded_tracks</span>(<span class="ruby-identifier">apk_version_codes</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:check_superseded_tracks</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track</span>].<span class="ruby-identifier">eql?</span>(<span class="ruby-string">&quot;rollout&quot;</span>)
    <span class="ruby-identifier">client</span>.<span class="ruby-identifier">update_track</span>(<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track</span>], <span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:rollout</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0.1</span>, <span class="ruby-identifier">apk_version_codes</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">client</span>.<span class="ruby-identifier">update_track</span>(<span class="ruby-constant">Supply</span>.<span class="ruby-identifier">config</span>[<span class="ruby-value">:track</span>], <span class="ruby-value">1.0</span>, <span class="ruby-identifier">apk_version_codes</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_binary_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_binary_data</span><span
            class="method-args">(apk_path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Upload binary apk and obb and corresponding change logs with client</p>

<p>@param [String] apk_path</p>

<pre>Path of the apk file to upload.</pre>

<p>@return [Integer] The apk version code returned after uploading, or nil if
there was a problem</p>
          
          

          
          <div class="method-source-code" id="upload_binary_data-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 180</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_binary_data</span>(<span class="ruby-identifier">apk_path</span>)
  <span class="ruby-identifier">apk_version_code</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">apk_path</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Preparing apk at path &#39;#{apk_path}&#39; for upload...&quot;</span>)
    <span class="ruby-identifier">apk_version_code</span> = <span class="ruby-identifier">client</span>.<span class="ruby-identifier">upload_apk</span>(<span class="ruby-identifier">apk_path</span>)
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">user_error!</span>(<span class="ruby-node">&quot;Could not upload #{apk_path}&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">apk_version_code</span>

    <span class="ruby-identifier">upload_obbs</span>(<span class="ruby-identifier">apk_path</span>, <span class="ruby-identifier">apk_version_code</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">metadata_path</span>
      <span class="ruby-identifier">all_languages</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">language</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">language</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&#39;.&#39;</span>) <span class="ruby-comment"># e.g. . or .. or hidden folders</span>
        <span class="ruby-identifier">upload_changelog</span>(<span class="ruby-identifier">language</span>, <span class="ruby-identifier">apk_version_code</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-string">&quot;No apk file found, you can pass the path to your apk using the `apk` option&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">apk_version_code</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_obb" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_obb</span><span
            class="method-args">(obb_path, expansion_file_type, apk_version_code)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="upload_obb-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 302</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_obb</span>(<span class="ruby-identifier">obb_path</span>, <span class="ruby-identifier">expansion_file_type</span>, <span class="ruby-identifier">apk_version_code</span>)
  <span class="ruby-constant">UI</span>.<span class="ruby-identifier">message</span>(<span class="ruby-node">&quot;Uploading obb file #{obb_path}...&quot;</span>)
  <span class="ruby-identifier">client</span>.<span class="ruby-identifier">upload_obb</span>(<span class="ruby-identifier">obb_file_path</span><span class="ruby-operator">:</span> <span class="ruby-identifier">obb_path</span>,
                    <span class="ruby-identifier">apk_version_code</span><span class="ruby-operator">:</span> <span class="ruby-identifier">apk_version_code</span>,
                    <span class="ruby-identifier">expansion_file_type</span><span class="ruby-operator">:</span> <span class="ruby-identifier">expansion_file_type</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-upload_obbs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload_obbs</span><span
            class="method-args">(apk_path, apk_version_code)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>searches for obbs in the directory where the apk is located and upload at
most one main and one patch file. Do nothing if it finds more than one of
either of them.</p>
          
          

          
          <div class="method-source-code" id="upload_obbs-source">
            <pre><span class="ruby-comment"># File supply/lib/supply/uploader.rb, line 272</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload_obbs</span>(<span class="ruby-identifier">apk_path</span>, <span class="ruby-identifier">apk_version_code</span>)
  <span class="ruby-identifier">expansion_paths</span> = <span class="ruby-identifier">find_obbs</span>(<span class="ruby-identifier">apk_path</span>)
  [<span class="ruby-string">&#39;main&#39;</span>, <span class="ruby-string">&#39;patch&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">expansion_paths</span>[<span class="ruby-identifier">type</span>]
      <span class="ruby-identifier">upload_obb</span>(<span class="ruby-identifier">expansion_paths</span>[<span class="ruby-identifier">type</span>], <span class="ruby-identifier">type</span>, <span class="ruby-identifier">apk_version_code</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

