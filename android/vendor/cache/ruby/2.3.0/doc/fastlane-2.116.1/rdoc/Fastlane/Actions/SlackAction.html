<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Fastlane::Actions::SlackAction - fastlane-2.116.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Action.html">Fastlane::Action</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-author">::author</a>
    
    <li ><a href="#method-c-available_options">::available_options</a>
    
    <li ><a href="#method-c-category">::category</a>
    
    <li ><a href="#method-c-deep_merge">::deep_merge</a>
    
    <li ><a href="#method-c-description">::description</a>
    
    <li ><a href="#method-c-details">::details</a>
    
    <li ><a href="#method-c-example_code">::example_code</a>
    
    <li ><a href="#method-c-generate_slack_attachments">::generate_slack_attachments</a>
    
    <li ><a href="#method-c-is_supported-3F">::is_supported?</a>
    
    <li ><a href="#method-c-run">::run</a>
    
    <li ><a href="#method-c-trim_message">::trim_message</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Fastlane::Actions::SlackAction">
  <h1 id="class-Fastlane::Actions::SlackAction" class="class">
    class Fastlane::Actions::SlackAction
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-author" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">author</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="author-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 143</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">author</span>
  <span class="ruby-string">&quot;KrauseFx&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-available_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">available_options</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="available_options-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 68</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">available_options</span>
  [
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:message</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_MESSAGE&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;The message that should be displayed on Slack. This supports the standard Slack markup language&quot;</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:pretext</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_PRETEXT&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;This is optional text that appears above the message attachment block. This supports the standard Slack markup language&quot;</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:channel</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_CHANNEL&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-node">&quot;#channel or @username&quot;</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:use_webhook_configured_username_and_icon</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_USE_WEBHOOK_CONFIGURED_USERNAME_AND_ICON&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Use webhook&#39;s default username and icon settings? (true/false)&quot;</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:slack_url</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;SLACK_URL&quot;</span>,
                                 <span class="ruby-identifier">sensitive</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Create an Incoming WebHook for your Slack group&quot;</span>,
                                 <span class="ruby-identifier">verify_block</span><span class="ruby-operator">:</span> <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
                                   <span class="ruby-constant">UI</span>.<span class="ruby-identifier">user_error!</span>(<span class="ruby-string">&quot;Invalid URL, must start with https://&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&quot;https://&quot;</span>)
                                 <span class="ruby-keyword">end</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:username</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_USERNAME&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Overrides the webhook&#39;s username property if use_webhook_configured_username_and_icon is false&quot;</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;fastlane&quot;</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:icon_url</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_ICON_URL&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Overrides the webhook&#39;s image property if use_webhook_configured_username_and_icon is false&quot;</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;https://s3-eu-west-1.amazonaws.com/fastlane.tools/fastlane.png&quot;</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:payload</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_PAYLOAD&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Add additional information to this post. payload must be a hash containing any key with any value&quot;</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> {},
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:default_payloads</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_DEFAULT_PAYLOADS&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Remove some of the default payloads. More information about the available payloads on GitHub&quot;</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">type</span><span class="ruby-operator">:</span> <span class="ruby-constant">Array</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:attachment_properties</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_ATTACHMENT_PROPERTIES&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Merge additional properties in the slack attachment, see https://api.slack.com/docs/attachments&quot;</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> {},
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:success</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_SUCCESS&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Was this build successful? (true/false)&quot;</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:fail_on_error</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_FAIL_ON_ERROR&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Should an error sending the slack notification cause a failure? (true/false)&quot;</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>),
    <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">ConfigItem</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-value">:link_names</span>,
                                 <span class="ruby-identifier">env_name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;FL_SLACK_LINK_NAMES&quot;</span>,
                                 <span class="ruby-identifier">description</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Find and link channel names and usernames (true/false)&quot;</span>,
                                 <span class="ruby-identifier">optional</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>,
                                 <span class="ruby-identifier">default_value</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>,
                                 <span class="ruby-identifier">is_string</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-category" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">category</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="category-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">category</span>
  <span class="ruby-value">:notifications</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-deep_merge" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">deep_merge</span><span
            class="method-args">(a, b)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adapted from <a
href="https://stackoverflow.com/a/30225093/158525">stackoverflow.com/a/30225093/158525</a></p>
          
          

          
          <div class="method-source-code" id="deep_merge-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 271</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">deep_merge</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>)
  <span class="ruby-identifier">merger</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">v1</span>, <span class="ruby-identifier">v2</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">v1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">v2</span> <span class="ruby-operator">?</span>
           <span class="ruby-identifier">v1</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">v2</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">merger</span>) <span class="ruby-operator">:</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">v1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">v2</span> <span class="ruby-operator">?</span>
             <span class="ruby-identifier">v1</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">v2</span> <span class="ruby-operator">:</span> [<span class="ruby-value">:undefined</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">:nil</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">v2</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">v1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">v2</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">a</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">b</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">merger</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-description" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">description</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="description-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 64</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span>
  <span class="ruby-string">&quot;Send a success/error message to your [Slack](https://slack.com) group&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-details" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">details</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="details-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">details</span>
  <span class="ruby-node">&quot;Create an Incoming WebHook and export this as `SLACK_URL`. Can send a message to **#channel** (by default), a direct message to **@username** or a message to a private group **group** with success (green) or failure (red) status.&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-example_code" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">example_code</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="example_code-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 147</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">example_code</span>
  [
    <span class="ruby-string">&#39;slack(message: &quot;App successfully released!&quot;)&#39;</span>,
    <span class="ruby-string">&#39;slack(
      message: &quot;App successfully released!&quot;,
      channel: &quot;#channel&quot;,  # Optional, by default will post to the default channel configured for the POST URL.
      success: true,        # Optional, defaults to true.
      payload: {            # Optional, lets you specify any number of your own Slack attachments.
        &quot;Build Date&quot; =&gt; Time.new.to_s,
        &quot;Built by&quot; =&gt; &quot;Jenkins&quot;,
      },
      default_payloads: [:git_branch, :git_author], # Optional, lets you specify a whitelist of default payloads to include. Pass an empty array to suppress all the default payloads.
                                                    # Don\t add this key, or pass nil, if you want all the default payloads. The available default payloads are: `lane`, `test_result`, `git_branch`, `git_author`, `last_git_commit`, `last_git_commit_hash`.
      attachment_properties: { # Optional, lets you specify any other properties available for attachments in the slack API (see https://api.slack.com/docs/attachments).
                               # This hash is deep merged with the existing properties set using the other properties above. This allows your own fields properties to be appended to the existing fields that were created using the `payload` property for instance.
        thumb_url: &quot;http://example.com/path/to/thumb.png&quot;,
        fields: [{
          title: &quot;My Field&quot;,
          value: &quot;My Value&quot;,
          short: true
        }]
      }
    )&#39;</span>
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-generate_slack_attachments" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">generate_slack_attachments</span><span
            class="method-args">(options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>@!group <a href="../Helper.html">Helper</a></p>
          
          

          
          <div class="method-source-code" id="generate_slack_attachments-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 185</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">generate_slack_attachments</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">color</span> = (<span class="ruby-identifier">options</span>[<span class="ruby-value">:success</span>] <span class="ruby-operator">?</span> <span class="ruby-string">&#39;good&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;danger&#39;</span>)
  <span class="ruby-identifier">should_add_payload</span> = <span class="ruby-operator">-</span><span class="ruby-operator">&gt;</span>(<span class="ruby-identifier">payload_name</span>) { <span class="ruby-identifier">options</span>[<span class="ruby-value">:default_payloads</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:default_payloads</span>].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_sym</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">payload_name</span>.<span class="ruby-identifier">to_sym</span>) }

  <span class="ruby-identifier">slack_attachment</span> = {
    <span class="ruby-identifier">fallback</span><span class="ruby-operator">:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:message</span>],
    <span class="ruby-identifier">text</span><span class="ruby-operator">:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:message</span>],
    <span class="ruby-identifier">pretext</span><span class="ruby-operator">:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:pretext</span>],
    <span class="ruby-identifier">color</span><span class="ruby-operator">:</span> <span class="ruby-identifier">color</span>,
    <span class="ruby-identifier">mrkdwn_in</span><span class="ruby-operator">:</span> [<span class="ruby-string">&quot;pretext&quot;</span>, <span class="ruby-string">&quot;text&quot;</span>, <span class="ruby-string">&quot;fields&quot;</span>, <span class="ruby-string">&quot;message&quot;</span>],
    <span class="ruby-identifier">fields</span><span class="ruby-operator">:</span> []
  }

  <span class="ruby-comment"># custom user payloads</span>
  <span class="ruby-identifier">slack_attachment</span>[<span class="ruby-value">:fields</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:payload</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    {
      <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>,
      <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-constant">Slack</span><span class="ruby-operator">::</span><span class="ruby-constant">Notifier</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">LinkFormatter</span>.<span class="ruby-identifier">format</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span>),
      <span class="ruby-identifier">short</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Add the lane to the Slack message</span>
  <span class="ruby-comment"># This might be nil, if slack is called as &quot;one-off&quot; action</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">should_add_payload</span>[<span class="ruby-value">:lane</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">lane_context</span>[<span class="ruby-constant">Actions</span><span class="ruby-operator">::</span><span class="ruby-constant">SharedValues</span><span class="ruby-operator">::</span><span class="ruby-constant">LANE_NAME</span>]
    <span class="ruby-identifier">slack_attachment</span>[<span class="ruby-value">:fields</span>] <span class="ruby-operator">&lt;&lt;</span> {
      <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Lane&#39;</span>,
      <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">lane_context</span>[<span class="ruby-constant">Actions</span><span class="ruby-operator">::</span><span class="ruby-constant">SharedValues</span><span class="ruby-operator">::</span><span class="ruby-constant">LANE_NAME</span>],
      <span class="ruby-identifier">short</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># test_result</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">should_add_payload</span>[<span class="ruby-value">:test_result</span>]
    <span class="ruby-identifier">slack_attachment</span>[<span class="ruby-value">:fields</span>] <span class="ruby-operator">&lt;&lt;</span> {
      <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Result&#39;</span>,
      <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> (<span class="ruby-identifier">options</span>[<span class="ruby-value">:success</span>] <span class="ruby-operator">?</span> <span class="ruby-string">&#39;Success&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;Error&#39;</span>),
      <span class="ruby-identifier">short</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># git branch</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">git_branch</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">should_add_payload</span>[<span class="ruby-value">:git_branch</span>]
    <span class="ruby-identifier">slack_attachment</span>[<span class="ruby-value">:fields</span>] <span class="ruby-operator">&lt;&lt;</span> {
      <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Git Branch&#39;</span>,
      <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">git_branch</span>,
      <span class="ruby-identifier">short</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># git_author</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">git_author_email</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">should_add_payload</span>[<span class="ruby-value">:git_author</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-constant">FastlaneCore</span><span class="ruby-operator">::</span><span class="ruby-constant">Env</span>.<span class="ruby-identifier">truthy?</span>(<span class="ruby-string">&#39;FASTLANE_SLACK_HIDE_AUTHOR_ON_SUCCESS&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:success</span>]
      <span class="ruby-comment"># We only show the git author if the build failed</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">slack_attachment</span>[<span class="ruby-value">:fields</span>] <span class="ruby-operator">&lt;&lt;</span> {
        <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Git Author&#39;</span>,
        <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">git_author_email</span>,
        <span class="ruby-identifier">short</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
      }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># last_git_commit</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">last_git_commit_message</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">should_add_payload</span>[<span class="ruby-value">:last_git_commit</span>]
    <span class="ruby-identifier">slack_attachment</span>[<span class="ruby-value">:fields</span>] <span class="ruby-operator">&lt;&lt;</span> {
      <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Git Commit&#39;</span>,
      <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">last_git_commit_message</span>,
      <span class="ruby-identifier">short</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># last_git_commit_hash</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">last_git_commit_hash</span>(<span class="ruby-keyword">true</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">should_add_payload</span>[<span class="ruby-value">:last_git_commit_hash</span>]
    <span class="ruby-identifier">slack_attachment</span>[<span class="ruby-value">:fields</span>] <span class="ruby-operator">&lt;&lt;</span> {
      <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Git Commit Hash&#39;</span>,
      <span class="ruby-identifier">value</span><span class="ruby-operator">:</span> <span class="ruby-constant">Actions</span>.<span class="ruby-identifier">last_git_commit_hash</span>(<span class="ruby-identifier">short</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>),
      <span class="ruby-identifier">short</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># merge additional properties</span>
  <span class="ruby-identifier">deep_merge</span>(<span class="ruby-identifier">slack_attachment</span>, <span class="ruby-identifier">options</span>[<span class="ruby-value">:attachment_properties</span>])
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-is_supported-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_supported?</span><span
            class="method-args">(platform)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="is_supported-3F-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 7</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">is_supported?</span>(<span class="ruby-identifier">platform</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-run" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run</span><span
            class="method-args">(options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="run-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;slack-notifier&#39;</span>

  <span class="ruby-identifier">options</span>[<span class="ruby-value">:message</span>] = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">trim_message</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:message</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-identifier">options</span>[<span class="ruby-value">:message</span>] = <span class="ruby-constant">Slack</span><span class="ruby-operator">::</span><span class="ruby-constant">Notifier</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">LinkFormatter</span>.<span class="ruby-identifier">format</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:message</span>])

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:channel</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">channel</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:channel</span>]
    <span class="ruby-identifier">channel</span> = (<span class="ruby-string">&#39;#&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:channel</span>]) <span class="ruby-keyword">unless</span> [<span class="ruby-string">&#39;#&#39;</span>, <span class="ruby-string">&#39;@&#39;</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">channel</span>[<span class="ruby-value">0</span>]) <span class="ruby-comment"># send message to channel by default</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">username</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:use_webhook_configured_username_and_icon</span>] <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:username</span>]

  <span class="ruby-identifier">notifier</span> = <span class="ruby-constant">Slack</span><span class="ruby-operator">::</span><span class="ruby-constant">Notifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:slack_url</span>], <span class="ruby-identifier">channel</span><span class="ruby-operator">:</span> <span class="ruby-identifier">channel</span>, <span class="ruby-identifier">username</span><span class="ruby-operator">:</span> <span class="ruby-identifier">username</span>)

  <span class="ruby-identifier">link_names</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:link_names</span>]

  <span class="ruby-identifier">icon_url</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:use_webhook_configured_username_and_icon</span>] <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:icon_url</span>]

  <span class="ruby-identifier">slack_attachment</span> = <span class="ruby-identifier">generate_slack_attachments</span>(<span class="ruby-identifier">options</span>)

  <span class="ruby-keyword">return</span> [<span class="ruby-identifier">notifier</span>, <span class="ruby-identifier">slack_attachment</span>] <span class="ruby-keyword">if</span> <span class="ruby-constant">Helper</span>.<span class="ruby-identifier">test?</span> <span class="ruby-comment"># tests will verify the slack attachments and other properties</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">results</span> = <span class="ruby-identifier">notifier</span>.<span class="ruby-identifier">ping</span>(<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">link_names</span><span class="ruby-operator">:</span> <span class="ruby-identifier">link_names</span>, <span class="ruby-identifier">icon_url</span><span class="ruby-operator">:</span> <span class="ruby-identifier">icon_url</span>, <span class="ruby-identifier">attachments</span><span class="ruby-operator">:</span> [<span class="ruby-identifier">slack_attachment</span>])
  <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">exception</span>
    <span class="ruby-constant">UI</span>.<span class="ruby-identifier">error</span>(<span class="ruby-node">&quot;Exception: #{exception}&quot;</span>)
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-identifier">result</span> = <span class="ruby-identifier">results</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">results</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">result</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">code</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">==</span> <span class="ruby-value">200</span>
      <span class="ruby-constant">UI</span>.<span class="ruby-identifier">success</span>(<span class="ruby-string">&#39;Successfully sent Slack notification&#39;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">UI</span>.<span class="ruby-identifier">verbose</span>(<span class="ruby-identifier">result</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">result</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">message</span> = <span class="ruby-string">&quot;Error pushing Slack message, maybe the integration has no permission to post on this channel? Try removing the channel parameter in your Fastfile, this is usually caused by a misspelled or changed group/channel name or an expired SLACK_URL&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:fail_on_error</span>]
        <span class="ruby-constant">UI</span>.<span class="ruby-identifier">user_error!</span>(<span class="ruby-identifier">message</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">UI</span>.<span class="ruby-identifier">error</span>(<span class="ruby-identifier">message</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-trim_message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">trim_message</span><span
            class="method-args">(message)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>As there is a text limit in the notifications, we are usually interested in
the last part of the message e.g. for tests</p>
          
          

          
          <div class="method-source-code" id="trim_message-source">
            <pre><span class="ruby-comment"># File fastlane/lib/fastlane/actions/slack.rb, line 14</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">trim_message</span>(<span class="ruby-identifier">message</span>)
  <span class="ruby-comment"># We want the last 7000 characters, instead of the first 7000, as the error is at the bottom</span>
  <span class="ruby-identifier">start_index</span> = [<span class="ruby-identifier">message</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">7000</span>, <span class="ruby-value">0</span>].<span class="ruby-identifier">max</span>
  <span class="ruby-identifier">message</span> = <span class="ruby-identifier">message</span>[<span class="ruby-identifier">start_index</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
  <span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

